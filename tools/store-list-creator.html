<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafe‚òÖLog - Â∫óËàó„É™„Çπ„Éà‰ΩúÊàê„ÉÑ„Éº„É´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #00704A;
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #00704A;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            border-bottom: 2px solid #00704A;
            padding-bottom: 0.5rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            outline: none;
            border-color: #00704A;
        }

        .input-group textarea {
            height: 100px;
            resize: vertical;
        }

        .btn {
            background: #00704A;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: background 0.2s;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .btn:hover {
            background: #005a38;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .coordinate-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .coordinate-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .coord-method {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s;
        }

        .coord-method:hover {
            border-color: #00704A;
        }

        .coord-method.active {
            border-color: #00704A;
            background: #f8fff8;
        }

        .store-list {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .store-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid #00704A;
        }

        .store-item h4 {
            color: #00704A;
            margin-bottom: 0.5rem;
        }

        .store-item .store-details {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.5rem;
        }

        .store-item .coordinates {
            font-family: monospace;
            font-size: 0.8rem;
            background: white;
            padding: 0.3rem 0.5rem;
            border-radius: 4px;
            display: inline-block;
        }

        .validation-status {
            margin: 1rem 0;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 600;
        }

        .validation-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .validation-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .validation-status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .stat-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #00704A;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
            margin-top: 0.2rem;
        }

        .export-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: #00704A;
            transition: width 0.3s ease;
        }

        .hidden {
            display: none;
        }

        .manual-adjustment-item {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .manual-adjustment-item h4 {
            color: #856404;
            margin-bottom: 0.5rem;
        }

        .adjustment-reason {
            font-size: 0.8rem;
            color: #856404;
            margin-bottom: 1rem;
        }

        .adjustment-controls {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.5rem;
        }

        .places-suggestion {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .places-suggestion h5 {
            color: #0c5460;
            margin-bottom: 0.5rem;
        }

        .confidence-score {
            display: inline-block;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .confidence-high {
            background: #d4edda;
            color: #155724;
        }

        .confidence-medium {
            background: #fff3cd;
            color: #856404;
        }

        .confidence-low {
            background: #f8d7da;
            color: #721c24;
        }

        .enrichment-progress {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #00704A;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .coordinate-methods {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚òï Cafe‚òÖLog Â∫óËàó„É™„Çπ„Éà‰ΩúÊàê„ÉÑ„Éº„É´</h1>
            <p>Ê≠£Á¢∫„Å™Â∫ßÊ®ôÊÉÖÂ†±„Å®ÂìÅË≥™ÁÆ°ÁêÜÊ©üËÉΩ„ÇíÂÇô„Åà„ÅüÂ∫óËàó„Éá„Éº„Çø‰ΩúÊàê„Ç∑„Çπ„ÉÜ„É†</p>
        </div>

        <div class="main-content">
            <!-- Â∫óËàóÂÖ•Âäõ„Éë„Éç„É´ -->
            <div class="panel">
                <h2>üìç Â∫óËàóÊÉÖÂ†±ÂÖ•Âäõ</h2>
                
                <div class="input-group">
                    <label for="storeName">Â∫óËàóÂêç *</label>
                    <input type="text" id="storeName" placeholder="‰æã: „Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Ê∏ãË∞∑„Çπ„ÇØ„É©„É≥„Éñ„É´„Çπ„ÇØ„Ç®„Ç¢Â∫ó">
                    <div class="error-message hidden" id="storeNameError"></div>
                </div>

                <div class="input-group">
                    <label for="storeAddress">‰ΩèÊâÄ *</label>
                    <input type="text" id="storeAddress" placeholder="‰æã: Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫Ê∏ãË∞∑2-24-12">
                    <div class="error-message hidden" id="storeAddressError"></div>
                </div>

                <div class="input-group">
                    <label for="storePrefecture">ÈÉΩÈÅìÂ∫úÁúå *</label>
                    <select id="storePrefecture">
                        <option value="">ÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                        <option value="ÂåóÊµ∑ÈÅì">ÂåóÊµ∑ÈÅì</option>
                        <option value="ÈùíÊ£ÆÁúå">ÈùíÊ£ÆÁúå</option>
                        <option value="Â≤©ÊâãÁúå">Â≤©ÊâãÁúå</option>
                        <option value="ÂÆÆÂüéÁúå">ÂÆÆÂüéÁúå</option>
                        <option value="ÁßãÁî∞Áúå">ÁßãÁî∞Áúå</option>
                        <option value="Â±±ÂΩ¢Áúå">Â±±ÂΩ¢Áúå</option>
                        <option value="Á¶èÂ≥∂Áúå">Á¶èÂ≥∂Áúå</option>
                        <option value="Ëå®ÂüéÁúå">Ëå®ÂüéÁúå</option>
                        <option value="Ê†ÉÊú®Áúå">Ê†ÉÊú®Áúå</option>
                        <option value="Áæ§È¶¨Áúå">Áæ§È¶¨Áúå</option>
                        <option value="ÂüºÁéâÁúå">ÂüºÁéâÁúå</option>
                        <option value="ÂçÉËëâÁúå">ÂçÉËëâÁúå</option>
                        <option value="Êù±‰∫¨ÈÉΩ">Êù±‰∫¨ÈÉΩ</option>
                        <option value="Á•ûÂ•àÂ∑ùÁúå">Á•ûÂ•àÂ∑ùÁúå</option>
                        <option value="Êñ∞ÊΩüÁúå">Êñ∞ÊΩüÁúå</option>
                        <option value="ÂØåÂ±±Áúå">ÂØåÂ±±Áúå</option>
                        <option value="Áü≥Â∑ùÁúå">Áü≥Â∑ùÁúå</option>
                        <option value="Á¶è‰∫ïÁúå">Á¶è‰∫ïÁúå</option>
                        <option value="Â±±Ê¢®Áúå">Â±±Ê¢®Áúå</option>
                        <option value="Èï∑ÈáéÁúå">Èï∑ÈáéÁúå</option>
                        <option value="Â≤êÈòúÁúå">Â≤êÈòúÁúå</option>
                        <option value="ÈùôÂ≤°Áúå">ÈùôÂ≤°Áúå</option>
                        <option value="ÊÑõÁü•Áúå">ÊÑõÁü•Áúå</option>
                        <option value="‰∏âÈáçÁúå">‰∏âÈáçÁúå</option>
                        <option value="ÊªãË≥ÄÁúå">ÊªãË≥ÄÁúå</option>
                        <option value="‰∫¨ÈÉΩÂ∫ú">‰∫¨ÈÉΩÂ∫ú</option>
                        <option value="Â§ßÈò™Â∫ú">Â§ßÈò™Â∫ú</option>
                        <option value="ÂÖµÂ∫´Áúå">ÂÖµÂ∫´Áúå</option>
                        <option value="Â•àËâØÁúå">Â•àËâØÁúå</option>
                        <option value="ÂíåÊ≠åÂ±±Áúå">ÂíåÊ≠åÂ±±Áúå</option>
                        <option value="È≥•ÂèñÁúå">È≥•ÂèñÁúå</option>
                        <option value="Â≥∂Ê†πÁúå">Â≥∂Ê†πÁúå</option>
                        <option value="Â≤°Â±±Áúå">Â≤°Â±±Áúå</option>
                        <option value="Â∫ÉÂ≥∂Áúå">Â∫ÉÂ≥∂Áúå</option>
                        <option value="Â±±Âè£Áúå">Â±±Âè£Áúå</option>
                        <option value="Âæ≥Â≥∂Áúå">Âæ≥Â≥∂Áúå</option>
                        <option value="È¶ôÂ∑ùÁúå">È¶ôÂ∑ùÁúå</option>
                        <option value="ÊÑõÂ™õÁúå">ÊÑõÂ™õÁúå</option>
                        <option value="È´òÁü•Áúå">È´òÁü•Áúå</option>
                        <option value="Á¶èÂ≤°Áúå">Á¶èÂ≤°Áúå</option>
                        <option value="‰ΩêË≥ÄÁúå">‰ΩêË≥ÄÁúå</option>
                        <option value="Èï∑Â¥éÁúå">Èï∑Â¥éÁúå</option>
                        <option value="ÁÜäÊú¨Áúå">ÁÜäÊú¨Áúå</option>
                        <option value="Â§ßÂàÜÁúå">Â§ßÂàÜÁúå</option>
                        <option value="ÂÆÆÂ¥éÁúå">ÂÆÆÂ¥éÁúå</option>
                        <option value="ÈπøÂÖêÂ≥∂Áúå">ÈπøÂÖêÂ≥∂Áúå</option>
                        <option value="Ê≤ñÁ∏ÑÁúå">Ê≤ñÁ∏ÑÁúå</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="storePhone">ÈõªË©±Áï™Âè∑</label>
                    <input type="tel" id="storePhone" placeholder="‰æã: 03-1234-5678">
                </div>

                <div class="input-group">
                    <label for="storeHours">Âñ∂Ê•≠ÊôÇÈñì</label>
                    <input type="text" id="storeHours" placeholder="‰æã: Âπ≥Êó• 6:30-22:30">
                </div>

                <!-- Â∫ßÊ®ôÂèñÂæó„Çª„ÇØ„Ç∑„Éß„É≥ -->
                <div class="coordinate-section">
                    <h3>üó∫Ô∏è Â∫ßÊ®ôÂèñÂæóÊñπÊ≥ï</h3>
                    <div class="coordinate-methods">
                        <div class="coord-method active" data-method="auto">
                            <h4>Ëá™ÂãïÂèñÂæó</h4>
                            <p>‰ΩèÊâÄ„Åã„ÇâËá™Âãï„ÅßÂ∫ßÊ®ô„ÇíÂèñÂæó</p>
                        </div>
                        <div class="coord-method" data-method="manual">
                            <h4>ÊâãÂãïÂÖ•Âäõ</h4>
                            <p>Á∑ØÂ∫¶„ÉªÁµåÂ∫¶„ÇíÁõ¥Êé•ÂÖ•Âäõ</p>
                        </div>
                    </div>

                    <div id="autoCoordinates">
                        <button type="button" class="btn" onclick="getCoordinatesFromAddress()">
                            üìç ‰ΩèÊâÄ„Åã„ÇâÂ∫ßÊ®ô„ÇíÂèñÂæó
                        </button>
                        <div class="validation-status hidden" id="coordinateStatus"></div>
                    </div>

                    <div id="manualCoordinates" class="hidden">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="input-group">
                                <label for="latitude">Á∑ØÂ∫¶ *</label>
                                <input type="number" id="latitude" step="0.000001" placeholder="35.658581">
                            </div>
                            <div class="input-group">
                                <label for="longitude">ÁµåÂ∫¶ *</label>
                                <input type="number" id="longitude" step="0.000001" placeholder="139.701762">
                            </div>
                        </div>
                        <button type="button" class="btn-secondary btn" onclick="validateManualCoordinates()">
                            ‚úì Â∫ßÊ®ô„ÇíÊ§úË®º
                        </button>
                    </div>
                </div>

                <div class="input-group">
                    <label for="storeFeatures">ÁâπÂæ¥„ÉªË®≠ÂÇô</label>
                    <textarea id="storeFeatures" placeholder="‰æã: Wi-Fi, ÈõªÊ∫ê, Á¶ÅÁÖô, „Éâ„É©„Ç§„Éñ„Çπ„É´„Éº"></textarea>
                </div>

                <div style="text-align: center;">
                    <button type="button" class="btn" onclick="addStore()">
                        ‚ûï Â∫óËàó„ÇíËøΩÂä†
                    </button>
                    <button type="button" class="btn-secondary btn" onclick="clearForm()">
                        üóëÔ∏è „ÇØ„É™„Ç¢
                    </button>
                </div>

                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 2px solid #e9ecef;">
                    <h3 style="color: #00704A; margin-bottom: 1rem;">ü§ñ Ëá™Âãï„Éá„Éº„ÇøÁîüÊàê</h3>
                    <p style="font-size: 0.9rem; color: #666; margin-bottom: 1rem;">
                        ÂÖ®ÂõΩ„ÅÆ‰∏ªË¶Å„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„ÇπÂ∫óËàó„Éá„Éº„Çø„ÇíËá™Âãï„ÅßÁîüÊàê„Åó„Åæ„Åô
                    </p>
                    <button type="button" class="btn" onclick="generateAllStores()" style="background: #28a745; width: 100%;">
                        üöÄ ÂÖ®Â∫óËàó„Éá„Éº„Çø„ÇíËá™ÂãïÁîüÊàê
                    </button>
                    <div class="validation-status hidden" id="autoGenerationStatus"></div>
                    <div class="progress-bar hidden" id="autoGenerationProgress">
                        <div class="progress-fill" id="autoGenerationProgressFill"></div>
                    </div>
                </div>
            </div>

            <!-- ÂìÅË≥™ÁÆ°ÁêÜ„Éë„Éç„É´ -->
            <div class="panel">
                <h2>‚úÖ ÂìÅË≥™ÁÆ°ÁêÜ</h2>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-number" id="totalStores">0</div>
                        <div class="stat-label">Á∑èÂ∫óËàóÊï∞</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="validStores">0</div>
                        <div class="stat-label">Ê§úË®ºÊ∏à„Åø</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="duplicateStores">0</div>
                        <div class="stat-label">ÈáçË§áÊ§úÂá∫</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="errorStores">0</div>
                        <div class="stat-label">„Ç®„É©„Éº</div>
                    </div>
                </div>

                <button type="button" class="btn" onclick="validateAllStores()">
                    üîç ÂÖ®Â∫óËàóÊ§úË®º
                </button>
                <button type="button" class="btn-secondary btn" onclick="removeDuplicates()">
                    üßπ ÈáçË§áÂâäÈô§
                </button>
                <button type="button" class="btn" onclick="enrichWithPlacesAPI()" style="background: #17a2b8;">
                    üåê Places API „ÅßÊÉÖÂ†±Ë£úÂÆå
                </button>
                <button type="button" class="btn-danger btn" onclick="clearAllStores()">
                    üóëÔ∏è ÂÖ®ÂâäÈô§
                </button>

                <div class="validation-status hidden" id="globalValidationStatus"></div>

                <h3>üìä „Éá„Éº„ÇøÂìÅË≥™„É¨„Éù„Éº„Éà</h3>
                <div id="qualityReport"></div>

                <h3>‚ö†Ô∏è Ë¶ÅÊâãÂãïË™øÊï¥Â∫óËàó</h3>
                <div id="manualAdjustmentList"></div>
            </div>
        </div>

        <!-- Â∫óËàó„É™„Çπ„ÉàË°®Á§∫ -->
        <div class="store-list">
            <h2>üìã ÁôªÈå≤Ê∏à„ÅøÂ∫óËàó„É™„Çπ„Éà</h2>
            <div id="storeListContainer">
                <p style="text-align: center; color: #666; margin: 2rem 0;">
                    „Åæ„Å†Â∫óËàó„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                </p>
            </div>
        </div>

        <!-- „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Çª„ÇØ„Ç∑„Éß„É≥ -->
        <div class="export-section">
            <h2>üì§ „Éá„Éº„Çø„Ç®„ÇØ„Çπ„Éù„Éº„Éà</h2>
            
            <div class="input-group">
                <label for="dataVersion">„Éá„Éº„Çø„Éê„Éº„Ç∏„Éß„É≥</label>
                <input type="text" id="dataVersion" value="2.1.0" placeholder="‰æã: 2.1.0">
            </div>

            <div class="input-group">
                <label for="coverageDescription">„Ç´„Éê„É¨„ÉÉ„Ç∏Ë™¨Êòé</label>
                <input type="text" id="coverageDescription" placeholder="‰æã: ÂÖ®ÂõΩ47ÈÉΩÈÅìÂ∫úÁúå">
            </div>

            <button type="button" class="btn" onclick="exportToJSON()">
                üíæ JSON„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê
            </button>
            <button type="button" class="btn-secondary btn" onclick="importFromJSON()">
                üìÇ JSON„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„Åø
            </button>

            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport()">

            <div class="progress-bar hidden" id="exportProgress">
                <div class="progress-fill" id="exportProgressFill"></div>
            </div>

            <div class="validation-status hidden" id="exportStatus"></div>
        </div>
    </div>

    <!-- Google Maps API -->
    <script>
        let map, geocoder, stores = [];
        let currentCoordinateMethod = 'auto';

        // ÈÉΩÈÅìÂ∫úÁúå„Åã„Çâ„Ç®„É™„Ç¢„Å∏„ÅÆ„Éû„ÉÉ„Éî„É≥„Ç∞
        const PREFECTURE_TO_AREA = {
            'ÂåóÊµ∑ÈÅì': 'ÂåóÊµ∑ÈÅì',
            'ÈùíÊ£ÆÁúå': 'Êù±Âåó', 'Â≤©ÊâãÁúå': 'Êù±Âåó', 'ÂÆÆÂüéÁúå': 'Êù±Âåó', 'ÁßãÁî∞Áúå': 'Êù±Âåó', 'Â±±ÂΩ¢Áúå': 'Êù±Âåó', 'Á¶èÂ≥∂Áúå': 'Êù±Âåó',
            'Ëå®ÂüéÁúå': 'Èñ¢Êù±', 'Ê†ÉÊú®Áúå': 'Èñ¢Êù±', 'Áæ§È¶¨Áúå': 'Èñ¢Êù±', 'ÂüºÁéâÁúå': 'Èñ¢Êù±', 'ÂçÉËëâÁúå': 'Èñ¢Êù±', 'Êù±‰∫¨ÈÉΩ': 'Èñ¢Êù±', 'Á•ûÂ•àÂ∑ùÁúå': 'Èñ¢Êù±',
            'Êñ∞ÊΩüÁúå': '‰∏≠ÈÉ®', 'ÂØåÂ±±Áúå': '‰∏≠ÈÉ®', 'Áü≥Â∑ùÁúå': '‰∏≠ÈÉ®', 'Á¶è‰∫ïÁúå': '‰∏≠ÈÉ®', 'Â±±Ê¢®Áúå': '‰∏≠ÈÉ®', 'Èï∑ÈáéÁúå': '‰∏≠ÈÉ®', 'Â≤êÈòúÁúå': '‰∏≠ÈÉ®', 'ÈùôÂ≤°Áúå': '‰∏≠ÈÉ®', 'ÊÑõÁü•Áúå': '‰∏≠ÈÉ®',
            '‰∏âÈáçÁúå': 'ËøëÁïø', 'ÊªãË≥ÄÁúå': 'ËøëÁïø', '‰∫¨ÈÉΩÂ∫ú': 'ËøëÁïø', 'Â§ßÈò™Â∫ú': 'ËøëÁïø', 'ÂÖµÂ∫´Áúå': 'ËøëÁïø', 'Â•àËâØÁúå': 'ËøëÁïø', 'ÂíåÊ≠åÂ±±Áúå': 'ËøëÁïø',
            'È≥•ÂèñÁúå': '‰∏≠ÂõΩ', 'Â≥∂Ê†πÁúå': '‰∏≠ÂõΩ', 'Â≤°Â±±Áúå': '‰∏≠ÂõΩ', 'Â∫ÉÂ≥∂Áúå': '‰∏≠ÂõΩ', 'Â±±Âè£Áúå': '‰∏≠ÂõΩ',
            'Âæ≥Â≥∂Áúå': 'ÂõõÂõΩ', 'È¶ôÂ∑ùÁúå': 'ÂõõÂõΩ', 'ÊÑõÂ™õÁúå': 'ÂõõÂõΩ', 'È´òÁü•Áúå': 'ÂõõÂõΩ',
            'Á¶èÂ≤°Áúå': '‰πùÂ∑û', '‰ΩêË≥ÄÁúå': '‰πùÂ∑û', 'Èï∑Â¥éÁúå': '‰πùÂ∑û', 'ÁÜäÊú¨Áúå': '‰πùÂ∑û', 'Â§ßÂàÜÁúå': '‰πùÂ∑û', 'ÂÆÆÂ¥éÁúå': '‰πùÂ∑û', 'ÈπøÂÖêÂ≥∂Áúå': '‰πùÂ∑û', 'Ê≤ñÁ∏ÑÁúå': '‰πùÂ∑û'
        };

        function initMap() {
            geocoder = new google.maps.Geocoder();
            console.log('‚úÖ Google Maps API initialized');
        }

        // Â∫ßÊ®ôÂèñÂæóÊñπÊ≥ï„ÅÆÂàá„ÇäÊõø„Åà
        document.querySelectorAll('.coord-method').forEach(method => {
            method.addEventListener('click', function() {
                const selectedMethod = this.dataset.method;
                
                // „Ç¢„ÇØ„ÉÜ„Ç£„ÉñÁä∂ÊÖã„ÅÆÂàá„ÇäÊõø„Åà
                document.querySelectorAll('.coord-method').forEach(m => m.classList.remove('active'));
                this.classList.add('active');
                
                // „Éë„Éç„É´Ë°®Á§∫Âàá„ÇäÊõø„Åà
                document.getElementById('autoCoordinates').classList.toggle('hidden', selectedMethod !== 'auto');
                document.getElementById('manualCoordinates').classList.toggle('hidden', selectedMethod !== 'manual');
                
                currentCoordinateMethod = selectedMethod;
            });
        });

        // ‰ΩèÊâÄ„Åã„ÇâÂ∫ßÊ®ô„ÇíÂèñÂæóÔºàÈ´òÁ≤æÂ∫¶Ôºâ
        async function getCoordinatesFromAddress() {
            const address = document.getElementById('storeAddress').value.trim();
            const storeName = document.getElementById('storeName').value.trim();
            
            if (!address) {
                showCoordinateStatus('‰ΩèÊâÄ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            showCoordinateStatus('Â∫ßÊ®ô„ÇíÂèñÂæó‰∏≠...', 'loading');

            try {
                // Ë§áÊï∞„ÅÆÊ§úÁ¥¢„ÇØ„Ç®„É™„ÅßÁ≤æÂ∫¶Âêë‰∏ä
                const queries = [
                    `${storeName} ${address}`,  // Â∫óÂêç + ‰ΩèÊâÄ
                    address,                    // ‰ΩèÊâÄ„ÅÆ„Åø
                    address.replace(/[Ôºê-Ôºô]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0))  // ÂÖ®Ëßí‚ÜíÂçäËßíÂ§âÊèõ
                ];

                let bestResult = null;
                let bestAccuracy = 0;

                for (const query of queries) {
                    try {
                        const result = await geocodeAddress(query);
                        if (result && result.accuracy > bestAccuracy) {
                            bestResult = result;
                            bestAccuracy = result.accuracy;
                        }
                    } catch (e) {
                        console.log(`Geocoding failed for query: ${query}`);
                    }
                }

                if (bestResult) {
                    document.getElementById('latitude').value = bestResult.lat.toFixed(6);
                    document.getElementById('longitude').value = bestResult.lng.toFixed(6);
                    
                    showCoordinateStatus(
                        `‚úÖ Â∫ßÊ®ôÂèñÂæóÊàêÂäü (Á≤æÂ∫¶: ${getAccuracyText(bestAccuracy)})`,
                        'success'
                    );
                } else {
                    throw new Error('Â∫ßÊ®ô„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„Åß„Åó„Åü');
                }

            } catch (error) {
                console.error('Geocoding error:', error);
                showCoordinateStatus(`‚ùå Â∫ßÊ®ôÂèñÂæóÂ§±Êïó: ${error.message}`, 'error');
            }
        }

        // Geocoding Promise wrapper
        function geocodeAddress(address) {
            return new Promise((resolve, reject) => {
                geocoder.geocode({ address: address, region: 'JP' }, (results, status) => {
                    if (status === 'OK' && results.length > 0) {
                        const result = results[0];
                        const location = result.geometry.location;
                        
                        // Á≤æÂ∫¶Âà§ÂÆöÔºàlocation_type„Åã„ÇâÔºâ
                        let accuracy = 0;
                        switch (result.geometry.location_type) {
                            case 'ROOFTOP': accuracy = 10; break;           // Âª∫Áâ©„É¨„Éô„É´
                            case 'RANGE_INTERPOLATED': accuracy = 8; break; // Áï™Âú∞„É¨„Éô„É´
                            case 'GEOMETRIC_CENTER': accuracy = 6; break;   // Âú∞Âå∫„É¨„Éô„É´
                            case 'APPROXIMATE': accuracy = 4; break;        // Ê¶ÇÁÆó
                        }

                        // ‰ΩèÊâÄ„Çø„Ç§„Éó„Åã„Çâ„ÅÆÁ≤æÂ∫¶Âä†ÁÆó
                        const addressTypes = result.types;
                        if (addressTypes.includes('establishment')) accuracy += 2;
                        if (addressTypes.includes('premise')) accuracy += 1;

                        resolve({
                            lat: location.lat(),
                            lng: location.lng(),
                            accuracy: accuracy,
                            formatted_address: result.formatted_address,
                            location_type: result.geometry.location_type
                        });
                    } else {
                        reject(new Error(`Geocoding failed: ${status}`));
                    }
                });
            });
        }

        function getAccuracyText(accuracy) {
            if (accuracy >= 9) return 'ÈùûÂ∏∏„Å´È´ò„ÅÑ';
            if (accuracy >= 7) return 'È´ò„ÅÑ';
            if (accuracy >= 5) return '‰∏≠Á®ãÂ∫¶';
            return '‰Ωé„ÅÑ';
        }

        // ÊâãÂãïÂ∫ßÊ®ô„ÅÆÊ§úË®º
        async function validateManualCoordinates() {
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);

            if (isNaN(lat) || isNaN(lng)) {
                showCoordinateStatus('‚ùå ÊúâÂäπ„Å™Á∑ØÂ∫¶„ÉªÁµåÂ∫¶„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // Êó•Êú¨„ÅÆÂ¢ÉÁïå„ÉÅ„Çß„ÉÉ„ÇØ
            if (lat < 20 || lat > 46 || lng < 123 || lng > 146) {
                showCoordinateStatus('‚ö†Ô∏è Â∫ßÊ®ô„ÅåÊó•Êú¨„ÅÆÁØÑÂõ≤Â§ñ„Åß„Åô', 'warning');
                return;
            }

            // ÈÄÜ„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞„Åß‰ΩèÊâÄÁ¢∫Ë™ç
            try {
                const reverseResult = await reverseGeocode(lat, lng);
                if (reverseResult) {
                    showCoordinateStatus(
                        `‚úÖ Â∫ßÊ®ôÊ§úË®ºÊàêÂäü: ${reverseResult.formatted_address}`,
                        'success'
                    );
                } else {
                    showCoordinateStatus('‚ö†Ô∏è Â∫ßÊ®ô„ÅØÊúâÂäπ„Åß„Åô„Åå„ÄÅ‰ΩèÊâÄÊÉÖÂ†±„ÇíÂèñÂæó„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü', 'warning');
                }
            } catch (error) {
                showCoordinateStatus('‚ö†Ô∏è Â∫ßÊ®ô„ÅØÊúâÂäπ„Åß„Åô„Åå„ÄÅÊ§úË®º‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'warning');
            }
        }

        // ÈÄÜ„Ç∏„Ç™„Ç≥„Éº„Éá„Ç£„É≥„Ç∞
        function reverseGeocode(lat, lng) {
            return new Promise((resolve, reject) => {
                geocoder.geocode({ location: { lat, lng } }, (results, status) => {
                    if (status === 'OK' && results.length > 0) {
                        resolve(results[0]);
                    } else {
                        reject(new Error(`Reverse geocoding failed: ${status}`));
                    }
                });
            });
        }

        // Â∫ßÊ®ô„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showCoordinateStatus(message, type) {
            const statusElement = document.getElementById('coordinateStatus');
            statusElement.textContent = message;
            statusElement.className = `validation-status ${type}`;
            statusElement.classList.remove('hidden');
        }

        // Â∫óËàóËøΩÂä†
        async function addStore() {
            if (!validateForm()) {
                return;
            }

            const storeData = collectFormData();
            
            // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
            if (isDuplicate(storeData)) {
                showGlobalStatus('‚ö†Ô∏è Âêå„ÅòÂ∫óËàó„ÅåÊó¢„Å´ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åô', 'warning');
                return;
            }

            // Â∫óËàóIDÁîüÊàê
            storeData.storeInfo.id = generateStoreId(storeData);

            stores.push(storeData);
            updateStoreList();
            updateStats();
            clearForm();
            
            showGlobalStatus('‚úÖ Â∫óËàó„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü', 'success');
        }

        // „Éï„Ç©„Éº„É†Ê§úË®º
        function validateForm() {
            let isValid = true;
            const errors = {};

            // ÂøÖÈ†àÈ†ÖÁõÆ„ÉÅ„Çß„ÉÉ„ÇØ
            const storeName = document.getElementById('storeName').value.trim();
            if (!storeName) {
                errors.storeName = 'Â∫óËàóÂêç„ÅØÂøÖÈ†à„Åß„Åô';
                isValid = false;
            }

            const storeAddress = document.getElementById('storeAddress').value.trim();
            if (!storeAddress) {
                errors.storeAddress = '‰ΩèÊâÄ„ÅØÂøÖÈ†à„Åß„Åô';
                isValid = false;
            }

            const prefecture = document.getElementById('storePrefecture').value;
            if (!prefecture) {
                errors.storePrefecture = 'ÈÉΩÈÅìÂ∫úÁúå„ÅØÂøÖÈ†à„Åß„Åô';
                isValid = false;
            }

            // Â∫ßÊ®ô„ÉÅ„Çß„ÉÉ„ÇØ
            const lat = parseFloat(document.getElementById('latitude').value);
            const lng = parseFloat(document.getElementById('longitude').value);
            if (isNaN(lat) || isNaN(lng)) {
                errors.coordinates = 'Â∫ßÊ®ôÊÉÖÂ†±„ÅåÂøÖË¶Å„Åß„Åô';
                isValid = false;
            }

            // „Ç®„É©„ÉºË°®Á§∫
            Object.keys(errors).forEach(field => {
                const errorElement = document.getElementById(field + 'Error');
                if (errorElement) {
                    errorElement.textContent = errors[field];
                    errorElement.classList.remove('hidden');
                }
            });

            // „Ç®„É©„Éº„ÅÆ„Å™„ÅÑ„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Ç®„É©„ÉºË°®Á§∫„Çí„ÇØ„É™„Ç¢
            document.querySelectorAll('.error-message').forEach(el => {
                const fieldName = el.id.replace('Error', '');
                if (!errors[fieldName]) {
                    el.classList.add('hidden');
                }
            });

            return isValid;
        }

        // „Éï„Ç©„Éº„É†„Éá„Éº„ÇøÂèéÈõÜ
        function collectFormData() {
            const prefecture = document.getElementById('storePrefecture').value;
            const features = document.getElementById('storeFeatures').value
                .split(',')
                .map(f => f.trim())
                .filter(f => f.length > 0);

            return {
                storeInfo: {
                    id: '', // Âæå„ÅßÁîüÊàê
                    name: document.getElementById('storeName').value.trim(),
                    address: document.getElementById('storeAddress').value.trim(),
                    coordinates: {
                        latitude: parseFloat(document.getElementById('latitude').value),
                        longitude: parseFloat(document.getElementById('longitude').value)
                    },
                    prefecture: prefecture,
                    city: extractCity(document.getElementById('storeAddress').value.trim()),
                    area: PREFECTURE_TO_AREA[prefecture] || '‰∏çÊòé'
                },
                businessInfo: {
                    hours: document.getElementById('storeHours').value.trim() || null,
                    phone: document.getElementById('storePhone').value.trim() || null,
                    features: features
                }
            };
        }

        // Â∏ÇÂå∫Áî∫ÊùëÊäΩÂá∫
        function extractCity(address) {
            const cityMatch = address.match(/([^ÈÉΩÈÅìÂ∫úÁúå]+[ÈÉΩÈÅìÂ∫úÁúå])(.+?[Â∏ÇÂå∫Áî∫Êùë])/);
            return cityMatch ? cityMatch[2] : '';
        }

        // Â∫óËàóIDÁîüÊàê
        function generateStoreId(storeData) {
            const prefecture = storeData.storeInfo.prefecture.replace(/[ÈÉΩÈÅìÂ∫úÁúå]/g, '');
            const city = storeData.storeInfo.city.replace(/[Â∏ÇÂå∫Áî∫Êùë]/g, '');
            const storeName = storeData.storeInfo.name
                .replace(/„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ|„Ç≥„Éº„Éí„Éº|Â∫ó/g, '')
                .trim();

            // Êó¢Â≠òID„Å®„ÅÆÈáçË§á„ÇíÈÅø„Åë„Çã„Åü„ÇÅ„ÅÆ„Ç´„Ç¶„É≥„Çø„Éº
            let counter = 1;
            let baseId = `store_${prefecture}_${city}_${storeName}`.toLowerCase()
                .replace(/[^a-z0-9_]/g, '_')
                .replace(/_+/g, '_')
                .replace(/^_|_$/g, '');

            let finalId = baseId;
            while (stores.some(store => store.storeInfo.id === finalId)) {
                finalId = `${baseId}_${String(counter).padStart(3, '0')}`;
                counter++;
            }

            return finalId;
        }

        // ÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
        function isDuplicate(newStore) {
            return stores.some(existingStore => {
                // ÂêçÂâç„Å®‰ΩèÊâÄ„ÅåÂÆåÂÖ®‰∏ÄËá¥
                if (existingStore.storeInfo.name === newStore.storeInfo.name &&
                    existingStore.storeInfo.address === newStore.storeInfo.address) {
                    return true;
                }

                // Â∫ßÊ®ô„Åå50m‰ª•ÂÜÖ
                const distance = calculateDistance(
                    existingStore.storeInfo.coordinates,
                    newStore.storeInfo.coordinates
                );
                return distance < 0.05; // 50m = 0.05km
            });
        }

        // Ë∑ùÈõ¢Ë®àÁÆóÔºàHaversine formulaÔºâ
        function calculateDistance(coord1, coord2) {
            const R = 6371; // Âú∞ÁêÉ„ÅÆÂçäÂæÑÔºàkmÔºâ
            const dLat = (coord2.latitude - coord1.latitude) * Math.PI / 180;
            const dLon = (coord2.longitude - coord1.longitude) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(coord1.latitude * Math.PI / 180) * Math.cos(coord2.latitude * Math.PI / 180) *
                Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Â∫óËàó„É™„Çπ„ÉàÊõ¥Êñ∞
        function updateStoreList() {
            const container = document.getElementById('storeListContainer');
            
            if (stores.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; margin: 2rem 0;">„Åæ„Å†Â∫óËàó„ÅåÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì</p>';
                return;
            }

            container.innerHTML = stores.map((store, index) => `
                <div class="store-item">
                    <h4>${store.storeInfo.name}</h4>
                    <div class="store-details">
                        üìç ${store.storeInfo.address}<br>
                        üè† ${store.storeInfo.prefecture} ${store.storeInfo.city} (${store.storeInfo.area})<br>
                        ${store.businessInfo.phone ? `üìû ${store.businessInfo.phone}<br>` : ''}
                        ${store.businessInfo.hours ? `üïí ${store.businessInfo.hours}<br>` : ''}
                        ${store.businessInfo.features.length > 0 ? `üè∑Ô∏è ${store.businessInfo.features.join(', ')}` : ''}
                    </div>
                    <div class="coordinates">
                        ID: ${store.storeInfo.id}<br>
                        Â∫ßÊ®ô: ${store.storeInfo.coordinates.latitude.toFixed(6)}, ${store.storeInfo.coordinates.longitude.toFixed(6)}
                    </div>
                    <button type="button" class="btn-danger btn" onclick="removeStore(${index})" style="margin-top: 0.5rem;">
                        üóëÔ∏è ÂâäÈô§
                    </button>
                </div>
            `).join('');
        }

        // Áµ±Ë®àÊõ¥Êñ∞
        function updateStats() {
            document.getElementById('totalStores').textContent = stores.length;
            document.getElementById('validStores').textContent = stores.length; // ËøΩÂä†ÊôÇÁÇπ„ÅßÊ§úË®ºÊ∏à„Åø
            document.getElementById('duplicateStores').textContent = findDuplicates().length;
            document.getElementById('errorStores').textContent = 0; // ËøΩÂä†ÊôÇÁÇπ„Åß„Ç®„É©„Éº„Å™„Åó
        }

        // Â∫óËàóÂâäÈô§
        function removeStore(index) {
            if (confirm('„Åì„ÅÆÂ∫óËàó„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                stores.splice(index, 1);
                updateStoreList();
                updateStats();
                showGlobalStatus('‚úÖ Â∫óËàó„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        // „Éï„Ç©„Éº„É†„ÇØ„É™„Ç¢
        function clearForm() {
            document.getElementById('storeName').value = '';
            document.getElementById('storeAddress').value = '';
            document.getElementById('storePrefecture').value = '';
            document.getElementById('storePhone').value = '';
            document.getElementById('storeHours').value = '';
            document.getElementById('storeFeatures').value = '';
            document.getElementById('latitude').value = '';
            document.getElementById('longitude').value = '';
            
            // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇØ„É™„Ç¢
            document.querySelectorAll('.error-message').forEach(el => el.classList.add('hidden'));
            document.getElementById('coordinateStatus').classList.add('hidden');
        }

        // ÂÖ®Â∫óËàóÂâäÈô§
        function clearAllStores() {
            if (confirm('ÂÖ®„Å¶„ÅÆÂ∫óËàó„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                stores = [];
                updateStoreList();
                updateStats();
                showGlobalStatus('‚úÖ ÂÖ®Â∫óËàó„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        // ÈáçË§áÊ§úÂá∫
        function findDuplicates() {
            const duplicates = [];
            for (let i = 0; i < stores.length; i++) {
                for (let j = i + 1; j < stores.length; j++) {
                    if (isDuplicate(stores[i])) {
                        duplicates.push({ index1: i, index2: j });
                    }
                }
            }
            return duplicates;
        }

        // ÈáçË§áÂâäÈô§
        function removeDuplicates() {
            const duplicates = findDuplicates();
            if (duplicates.length === 0) {
                showGlobalStatus('‚úÖ ÈáçË§á„Åô„ÇãÂ∫óËàó„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì', 'success');
                return;
            }

            if (confirm(`${duplicates.length}ÁµÑ„ÅÆÈáçË§á„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åó„Åü„ÄÇÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                // ÈáçË§á„ÅÆ2„Å§ÁõÆ„ÇíÂâäÈô§ÔºàÈÄÜÈ†Ü„ÅßÂâäÈô§„Åó„Å¶„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„Åö„Çå„ÇíÈò≤„ÅêÔºâ
                const indicesToRemove = duplicates.map(d => d.index2).sort((a, b) => b - a);
                indicesToRemove.forEach(index => stores.splice(index, 1));
                
                updateStoreList();
                updateStats();
                showGlobalStatus(`‚úÖ ${indicesToRemove.length}‰ª∂„ÅÆÈáçË§á„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü`, 'success');
            }
        }

        // ÂÖ®Â∫óËàóÊ§úË®º
        function validateAllStores() {
            const report = {
                total: stores.length,
                valid: 0,
                warnings: [],
                errors: []
            };

            stores.forEach((store, index) => {
                // Âü∫Êú¨ÁöÑ„Å™Ê§úË®º
                if (!store.storeInfo.name || !store.storeInfo.address) {
                    report.errors.push(`Â∫óËàó ${index + 1}: ÂøÖÈ†àÈ†ÖÁõÆ„Åå‰∏çË∂≥`);
                    return;
                }

                // Â∫ßÊ®ôÊ§úË®º
                const lat = store.storeInfo.coordinates.latitude;
                const lng = store.storeInfo.coordinates.longitude;
                if (isNaN(lat) || isNaN(lng)) {
                    report.errors.push(`Â∫óËàó ${index + 1}: Â∫ßÊ®ô„ÅåÁÑ°Âäπ`);
                    return;
                }

                if (lat < 20 || lat > 46 || lng < 123 || lng > 146) {
                    report.warnings.push(`Â∫óËàó ${index + 1}: Â∫ßÊ®ô„ÅåÊó•Êú¨„ÅÆÁØÑÂõ≤Â§ñ„ÅÆÂèØËÉΩÊÄß`);
                }

                report.valid++;
            });

            // „É¨„Éù„Éº„ÉàË°®Á§∫
            updateQualityReport(report);
            showGlobalStatus(`‚úÖ Ê§úË®ºÂÆå‰∫Ü: ${report.valid}/${report.total}‰ª∂„ÅåÊúâÂäπ`, 'success');
        }

        // ÂìÅË≥™„É¨„Éù„Éº„ÉàÊõ¥Êñ∞
        function updateQualityReport(report) {
            const reportContainer = document.getElementById('qualityReport');
            
            let html = `
                <div style="margin: 1rem 0;">
                    <h4>Ê§úË®ºÁµêÊûú</h4>
                    <p>ÊúâÂäπ: ${report.valid}/${report.total}‰ª∂</p>
                </div>
            `;

            if (report.warnings.length > 0) {
                html += `
                    <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <h5>‚ö†Ô∏è Ë≠¶Âëä (${report.warnings.length}‰ª∂)</h5>
                        <ul>
                            ${report.warnings.map(w => `<li>${w}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (report.errors.length > 0) {
                html += `
                    <div style="background: #f8d7da; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <h5>‚ùå „Ç®„É©„Éº (${report.errors.length}‰ª∂)</h5>
                        <ul>
                            ${report.errors.map(e => `<li>${e}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            if (report.warnings.length === 0 && report.errors.length === 0) {
                html += `
                    <div style="background: #d4edda; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
                        <h5>‚úÖ ÂïèÈ°å„Å™„Åó</h5>
                        <p>ÂÖ®„Å¶„ÅÆÂ∫óËàó„Éá„Éº„Çø„ÅåÊúâÂäπ„Åß„Åô„ÄÇ</p>
                    </div>
                `;
            }

            reportContainer.innerHTML = html;
        }

        // „Ç∞„É≠„Éº„Éê„É´„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showGlobalStatus(message, type) {
            const statusElement = document.getElementById('globalValidationStatus');
            statusElement.textContent = message;
            statusElement.className = `validation-status ${type}`;
            statusElement.classList.remove('hidden');
            
            // 3ÁßíÂæå„Å´Ëá™Âãï„ÅßÈùûË°®Á§∫
            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 3000);
        }

        // JSON„Ç®„ÇØ„Çπ„Éù„Éº„Éà
        function exportToJSON() {
            if (stores.length === 0) {
                showExportStatus('‚ùå „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„ÇãÂ∫óËàó„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            const dataVersion = document.getElementById('dataVersion').value.trim() || '2.1.0';
            const coverageDescription = document.getElementById('coverageDescription').value.trim() || 'Â∫óËàó„Éá„Éº„Çø';

            const exportData = {
                metadata: {
                    dataVersion: {
                        current: dataVersion,
                        compatible: [dataVersion]
                    },
                    generatedAt: new Date().toISOString(),
                    totalStores: stores.length,
                    coverage: coverageDescription,
                    generator: 'Cafe‚òÖLog Store List Creator Tool'
                },
                stores: stores,
                migrationSupport: {
                    legacyIdMapping: {},
                    deprecatedFields: []
                }
            };

            // „Éï„Ç°„Ç§„É´„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cafe-log-stores-v${dataVersion}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showExportStatus('‚úÖ JSON„Éï„Ç°„Ç§„É´„ÇíÁîüÊàê„Åó„Åæ„Åó„Åü', 'success');
        }

        // JSON„Ç§„É≥„Éù„Éº„Éà
        function importFromJSON() {
            document.getElementById('importFile').click();
        }

        function handleFileImport() {
            const file = document.getElementById('importFile').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    
                    // „Éá„Éº„ÇøÂΩ¢ÂºèÊ§úË®º
                    if (!importData.stores || !Array.isArray(importData.stores)) {
                        throw new Error('ÁÑ°Âäπ„Å™„Éá„Éº„ÇøÂΩ¢Âºè„Åß„Åô');
                    }

                    if (confirm(`${importData.stores.length}‰ª∂„ÅÆÂ∫óËàó„Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åô„ÅãÔºüÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØÁΩÆ„ÅçÊèõ„Åà„Çâ„Çå„Åæ„Åô„ÄÇ`)) {
                        stores = importData.stores;
                        updateStoreList();
                        updateStats();
                        
                        // „É°„Çø„Éá„Éº„Çø„ÇÇÊõ¥Êñ∞
                        if (importData.metadata) {
                            document.getElementById('dataVersion').value = importData.metadata.dataVersion.current || '2.1.0';
                            document.getElementById('coverageDescription').value = importData.metadata.coverage || '';
                        }

                        showExportStatus('‚úÖ „Éá„Éº„Çø„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü', 'success');
                    }
                } catch (error) {
                    showExportStatus(`‚ùå „Ç§„É≥„Éù„Éº„Éà„Ç®„É©„Éº: ${error.message}`, 'error');
                }
            };
            reader.readAsText(file);
        }

        // „Ç®„ÇØ„Çπ„Éù„Éº„Éà„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showExportStatus(message, type) {
            const statusElement = document.getElementById('exportStatus');
            statusElement.textContent = message;
            statusElement.className = `validation-status ${type}`;
            statusElement.classList.remove('hidden');
            
            setTimeout(() => {
                statusElement.classList.add('hidden');
            }, 5000);
        }

        // ÂÖ®Â∫óËàó„Éá„Éº„ÇøËá™ÂãïÁîüÊàê
        async function generateAllStores() {
            if (stores.length > 0 && !confirm('Êó¢Â≠ò„ÅÆÂ∫óËàó„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Åô„Åπ„Å¶ÂâäÈô§„Åó„Å¶Êñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÇíÁîüÊàê„Åó„Åæ„Åô„ÅãÔºü')) {
                return;
            }

            const storeTemplates = getSampleStoreData();
            
            // UIÊõ¥Êñ∞
            showAutoGenerationStatus('üöÄ ÂÖ®Â∫óËàó„Éá„Éº„Çø„ÇíÁîüÊàê‰∏≠...', 'loading');
            showAutoGenerationProgress(0);
            
            // Êó¢Â≠ò„Éá„Éº„Çø„ÇØ„É™„Ç¢
            stores = [];
            
            try {
                for (let i = 0; i < storeTemplates.length; i++) {
                    const template = storeTemplates[i];
                    
                    // „Éó„É≠„Ç∞„É¨„ÇπÊõ¥Êñ∞
                    const progress = ((i + 1) / storeTemplates.length) * 100;
                    showAutoGenerationProgress(progress);
                    showAutoGenerationStatus(`üìç Âá¶ÁêÜ‰∏≠ ${i + 1}/${storeTemplates.length}: ${template.name}`, 'loading');
                    
                    try {
                        // Â∫ßÊ®ôÂèñÂæó
                        const coordinates = await getCoordinatesForTemplate(template);
                        
                        if (coordinates) {
                            const storeData = {
                                storeInfo: {
                                    id: generateStoreId({
                                        storeInfo: {
                                            name: template.name,
                                            prefecture: template.prefecture,
                                            city: template.city
                                        }
                                    }),
                                    name: template.name,
                                    address: template.address,
                                    coordinates: coordinates,
                                    prefecture: template.prefecture,
                                    city: template.city,
                                    area: PREFECTURE_TO_AREA[template.prefecture] || '‰∏çÊòé'
                                },
                                businessInfo: {
                                    hours: template.hours || null,
                                    phone: template.phone || null,
                                    features: template.features || ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô']
                                }
                            };
                            
                            stores.push(storeData);
                        } else {
                            console.warn(`Â∫ßÊ®ôÂèñÂæóÂ§±Êïó: ${template.name}`);
                        }
                        
                        // API„É¨„Éº„ÉàÂà∂ÈôêÂØæÁ≠ñ
                        await new Promise(resolve => setTimeout(resolve, 100));
                        
                    } catch (error) {
                        console.error(`Â∫óËàóÂá¶ÁêÜ„Ç®„É©„Éº (${template.name}):`, error);
                    }
                }
                
                // ÂÆå‰∫ÜÂá¶ÁêÜ
                updateStoreList();
                updateStats();
                showAutoGenerationProgress(100);
                showAutoGenerationStatus(`‚úÖ ÁîüÊàêÂÆå‰∫ÜÔºÅ ${stores.length}Â∫óËàó„ÅÆ„Éá„Éº„Çø„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü`, 'success');
                
                // „Éó„É≠„Ç∞„É¨„Çπ„Éê„Éº„Çí3ÁßíÂæå„Å´ÈùûË°®Á§∫
                setTimeout(() => {
                    document.getElementById('autoGenerationProgress').classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                console.error('Ëá™ÂãïÁîüÊàê„Ç®„É©„Éº:', error);
                showAutoGenerationStatus(`‚ùå ÁîüÊàê„Ç®„É©„Éº: ${error.message}`, 'error');
            }
        }

        // „ÉÜ„É≥„Éó„É¨„Éº„ÉàÁî®Â∫ßÊ®ôÂèñÂæó
        async function getCoordinatesForTemplate(template) {
            try {
                const result = await geocodeAddress(template.address);
                if (result && result.accuracy >= 4) {
                    return {
                        latitude: result.lat,
                        longitude: result.lng
                    };
                }
                return null;
            } catch (error) {
                console.error(`Â∫ßÊ®ôÂèñÂæó„Ç®„É©„Éº (${template.name}):`, error);
                return null;
            }
        }

        // Ëá™ÂãïÁîüÊàê„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫
        function showAutoGenerationStatus(message, type) {
            const statusElement = document.getElementById('autoGenerationStatus');
            statusElement.textContent = message;
            statusElement.className = `validation-status ${type}`;
            statusElement.classList.remove('hidden');
        }

        // Ëá™ÂãïÁîüÊàê„Éó„É≠„Ç∞„É¨„ÇπË°®Á§∫
        function showAutoGenerationProgress(percentage) {
            const progressContainer = document.getElementById('autoGenerationProgress');
            const progressFill = document.getElementById('autoGenerationProgressFill');
            
            progressContainer.classList.remove('hidden');
            progressFill.style.width = `${percentage}%`;
        }

        // „Çµ„É≥„Éó„É´Â∫óËàó„Éá„Éº„ÇøÔºàÂÖ®ÂõΩ‰∏ªË¶ÅÂ∫óËàóÔºâ
        function getSampleStoreData() {
            return [
                // ÂåóÊµ∑ÈÅì
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Êú≠ÂπåÈßÖÂâçÂ∫ó', address: 'ÂåóÊµ∑ÈÅìÊú≠ÂπåÂ∏Ç‰∏≠Â§ÆÂå∫Âåó3Êù°Ë•ø3‰∏ÅÁõÆ1-1', prefecture: 'ÂåóÊµ∑ÈÅì', city: 'Êú≠ÂπåÂ∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Êñ∞ÂçÉÊ≠≥Á©∫Ê∏ØÂ∫ó', address: 'ÂåóÊµ∑ÈÅìÂçÉÊ≠≥Â∏ÇÁæé„ÄÖ987-22', prefecture: 'ÂåóÊµ∑ÈÅì', city: 'ÂçÉÊ≠≥Â∏Ç', hours: '6:00-21:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // Êù±Âåó
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ‰ªôÂè∞ÈßÖÂ∫ó', address: 'ÂÆÆÂüéÁúå‰ªôÂè∞Â∏ÇÈùíËëâÂå∫‰∏≠Â§Æ1‰∏ÅÁõÆ1-1', prefecture: 'ÂÆÆÂüéÁúå', city: '‰ªôÂè∞Â∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÈùíÊ£ÆÈßÖÂâçÂ∫ó', address: 'ÈùíÊ£ÆÁúåÈùíÊ£ÆÂ∏ÇÊñ∞Áî∫1‰∏ÅÁõÆ3-7', prefecture: 'ÈùíÊ£ÆÁúå', city: 'ÈùíÊ£ÆÂ∏Ç', hours: '7:00-21:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // Èñ¢Êù±
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Ê∏ãË∞∑„Çπ„ÇØ„É©„É≥„Éñ„É´„Çπ„ÇØ„Ç®„Ç¢Â∫ó', address: 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫Ê∏ãË∞∑2-24-12', prefecture: 'Êù±‰∫¨ÈÉΩ', city: 'Ê∏ãË∞∑Âå∫', hours: '6:30-23:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Êñ∞ÂÆøÂçóÂè£Â∫ó', address: 'Êù±‰∫¨ÈÉΩÊñ∞ÂÆøÂå∫Êñ∞ÂÆø3‰∏ÅÁõÆ38-1', prefecture: 'Êù±‰∫¨ÈÉΩ', city: 'Êñ∞ÂÆøÂå∫', hours: '6:30-23:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Êù±‰∫¨ÈßÖ‰∏∏„ÅÆÂÜÖÂåóÂè£Â∫ó', address: 'Êù±‰∫¨ÈÉΩÂçÉ‰ª£Áî∞Âå∫‰∏∏„ÅÆÂÜÖ1‰∏ÅÁõÆ9-1', prefecture: 'Êù±‰∫¨ÈÉΩ', city: 'ÂçÉ‰ª£Áî∞Âå∫', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Ê®™ÊµúÈßÖË•øÂè£Â∫ó', address: 'Á•ûÂ•àÂ∑ùÁúåÊ®™ÊµúÂ∏ÇË•øÂå∫ÂçóÂπ∏1‰∏ÅÁõÆ5-1', prefecture: 'Á•ûÂ•àÂ∑ùÁúå', city: 'Ê®™ÊµúÂ∏Ç', hours: '6:30-23:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Â§ßÂÆÆÈßÖÊù±Âè£Â∫ó', address: 'ÂüºÁéâÁúå„Åï„ÅÑ„Åü„ÅæÂ∏ÇÂ§ßÂÆÆÂå∫Â§ßÈñÄÁî∫1‰∏ÅÁõÆ90', prefecture: 'ÂüºÁéâÁúå', city: '„Åï„ÅÑ„Åü„ÅæÂ∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÂçÉËëâÈßÖÂâçÂ∫ó', address: 'ÂçÉËëâÁúåÂçÉËëâÂ∏Ç‰∏≠Â§ÆÂå∫Êñ∞Áî∫1000', prefecture: 'ÂçÉËëâÁúå', city: 'ÂçÉËëâÂ∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // ‰∏≠ÈÉ®
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÂêçÂè§Â±ãÈßÖÊ°úÈÄöÂè£Â∫ó', address: 'ÊÑõÁü•ÁúåÂêçÂè§Â±ãÂ∏Ç‰∏≠ÊùëÂå∫ÂêçÈßÖ1‰∏ÅÁõÆ1-4', prefecture: 'ÊÑõÁü•Áúå', city: 'ÂêçÂè§Â±ãÂ∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÈáëÊ≤¢ÈßÖÂ∫ó', address: 'Áü≥Â∑ùÁúåÈáëÊ≤¢Â∏ÇÊú®„ÉéÊñ∞‰øùÁî∫1-1', prefecture: 'Áü≥Â∑ùÁúå', city: 'ÈáëÊ≤¢Â∏Ç', hours: '6:30-22:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÈùôÂ≤°ÈßÖÂçóÂè£Â∫ó', address: 'ÈùôÂ≤°ÁúåÈùôÂ≤°Â∏ÇÈßøÊ≤≥Âå∫ÂçóÁî∫18-1', prefecture: 'ÈùôÂ≤°Áúå', city: 'ÈùôÂ≤°Â∏Ç', hours: '6:30-22:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // ËøëÁïø
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Â§ßÈò™ÈßÖ‰∏≠Â§ÆÊîπÊú≠Â§ñÂ∫ó', address: 'Â§ßÈò™Â∫úÂ§ßÈò™Â∏ÇÂåóÂå∫Ê¢ÖÁî∞3‰∏ÅÁõÆ1-1', prefecture: 'Â§ßÈò™Â∫ú', city: 'Â§ßÈò™Â∏Ç', hours: '6:30-23:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ‰∫¨ÈÉΩÈßÖÂÖ´Êù°Âè£Â∫ó', address: '‰∫¨ÈÉΩÂ∫ú‰∫¨ÈÉΩÂ∏ÇÂçóÂå∫Êù±‰πùÊù°Ë•øÂ±±ÁéãÁî∫31', prefecture: '‰∫¨ÈÉΩÂ∫ú', city: '‰∫¨ÈÉΩÂ∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Á•ûÊà∏‰∏âÂÆÆ„Çª„É≥„Çø„ÉºË°óÂ∫ó', address: 'ÂÖµÂ∫´ÁúåÁ•ûÊà∏Â∏Ç‰∏≠Â§ÆÂå∫‰∏âÂÆÆÁî∫1‰∏ÅÁõÆ5-26', prefecture: 'ÂÖµÂ∫´Áúå', city: 'Á•ûÊà∏Â∏Ç', hours: '7:00-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // ‰∏≠ÂõΩ
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Â∫ÉÂ≥∂ÈßÖÂçóÂè£Â∫ó', address: 'Â∫ÉÂ≥∂ÁúåÂ∫ÉÂ≥∂Â∏ÇÂçóÂå∫ÊùæÂéüÁî∫2-37', prefecture: 'Â∫ÉÂ≥∂Áúå', city: 'Â∫ÉÂ≥∂Â∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Â≤°Â±±ÈßÖÊù±Âè£Â∫ó', address: 'Â≤°Â±±ÁúåÂ≤°Â±±Â∏ÇÂåóÂå∫ÈßÖÂÖÉÁî∫15-1', prefecture: 'Â≤°Â±±Áúå', city: 'Â≤°Â±±Â∏Ç', hours: '6:30-22:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // ÂõõÂõΩ
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ È´òÊùæÈßÖÂ∫ó', address: 'È¶ôÂ∑ùÁúåÈ´òÊùæÂ∏ÇÊµú„ÉéÁî∫1-20', prefecture: 'È¶ôÂ∑ùÁúå', city: 'È´òÊùæÂ∏Ç', hours: '7:00-21:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÊùæÂ±±Â∏ÇÈßÖÂ∫ó', address: 'ÊÑõÂ™õÁúåÊùæÂ±±Â∏ÇÊπäÁî∫5‰∏ÅÁõÆ1-1', prefecture: 'ÊÑõÂ™õÁúå', city: 'ÊùæÂ±±Â∏Ç', hours: '7:00-21:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                
                // ‰πùÂ∑û
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÂçöÂ§öÈßÖ„Éû„Ç§„É≥„Ç∞Â∫ó', address: 'Á¶èÂ≤°ÁúåÁ¶èÂ≤°Â∏ÇÂçöÂ§öÂå∫ÂçöÂ§öÈßÖ‰∏≠Â§ÆË°ó1-1', prefecture: 'Á¶èÂ≤°Áúå', city: 'Á¶èÂ≤°Â∏Ç', hours: '6:30-22:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÁÜäÊú¨ÈßÖÂ∫ó', address: 'ÁÜäÊú¨ÁúåÁÜäÊú¨Â∏ÇË•øÂå∫Êò•Êó•3‰∏ÅÁõÆ15-30', prefecture: 'ÁÜäÊú¨Áúå', city: 'ÁÜäÊú¨Â∏Ç', hours: '7:00-21:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÈπøÂÖêÂ≥∂‰∏≠Â§ÆÈßÖÂ∫ó', address: 'ÈπøÂÖêÂ≥∂ÁúåÈπøÂÖêÂ≥∂Â∏Ç‰∏≠Â§ÆÁî∫1-1', prefecture: 'ÈπøÂÖêÂ≥∂Áúå', city: 'ÈπøÂÖêÂ≥∂Â∏Ç', hours: '7:00-21:30', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] },
                { name: '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ÈÇ£Ë¶áÁ©∫Ê∏ØÂ∫ó', address: 'Ê≤ñÁ∏ÑÁúåÈÇ£Ë¶áÂ∏ÇÈè°Ê∞¥150', prefecture: 'Ê≤ñÁ∏ÑÁúå', city: 'ÈÇ£Ë¶áÂ∏Ç', hours: '6:30-21:00', features: ['Wi-Fi', 'ÈõªÊ∫ê', 'Á¶ÅÁÖô'] }
            ];
        }

        // Places API „Å´„Çà„ÇãÊÉÖÂ†±Ë£úÂÆå
        async function enrichWithPlacesAPI() {
            if (stores.length === 0) {
                showGlobalStatus('‚ùå Ë£úÂÆå„Åô„ÇãÂ∫óËàó„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            if (!confirm(`${stores.length}Â∫óËàó„ÅÆÊÉÖÂ†±„ÇíPlaces API„ÅßË£úÂÆå„Åó„Åæ„Åô„ÅãÔºü\nÔºàAPI„ÇØ„Ç©„Éº„Çø„ÇíÊ∂àË≤ª„Åó„Åæ„ÅôÔºâ`)) {
                return;
            }

            const enrichmentResults = {
                total: stores.length,
                enriched: 0,
                failed: 0,
                needsManualAdjustment: []
            };

            showGlobalStatus('üåê Places API „Å´„Çà„ÇãÊÉÖÂ†±Ë£úÂÆå„ÇíÈñãÂßã...', 'loading');
            
            for (let i = 0; i < stores.length; i++) {
                const store = stores[i];
                showGlobalStatus(`üìç Âá¶ÁêÜ‰∏≠ ${i + 1}/${stores.length}: ${store.storeInfo.name}`, 'loading');

                try {
                    const enrichmentResult = await enrichStoreWithPlaces(store, i);
                    
                    if (enrichmentResult.success) {
                        enrichmentResults.enriched++;
                    } else {
                        enrichmentResults.failed++;
                        if (enrichmentResult.needsManualAdjustment) {
                            enrichmentResults.needsManualAdjustment.push({
                                index: i,
                                store: store,
                                reason: enrichmentResult.reason,
                                suggestions: enrichmentResult.suggestions || []
                            });
                        }
                    }

                    // API„É¨„Éº„ÉàÂà∂ÈôêÂØæÁ≠ñ
                    await new Promise(resolve => setTimeout(resolve, 200));

                } catch (error) {
                    console.error(`„Ç®„É©„Éº (${store.storeInfo.name}):`, error);
                    enrichmentResults.failed++;
                }
            }

            // ÁµêÊûúË°®Á§∫
            updateStoreList();
            updateStats();
            updateManualAdjustmentList(enrichmentResults.needsManualAdjustment);
            
            showGlobalStatus(
                `‚úÖ Ë£úÂÆåÂÆå‰∫Ü: ÊàêÂäü ${enrichmentResults.enriched}‰ª∂„ÄÅÂ§±Êïó ${enrichmentResults.failed}‰ª∂„ÄÅË¶ÅË™øÊï¥ ${enrichmentResults.needsManualAdjustment.length}‰ª∂`,
                'success'
            );
        }

        // ÂÄãÂà•Â∫óËàó„ÅÆ Places API Ë£úÂÆå
        async function enrichStoreWithPlaces(store, index) {
            const queries = [
                `${store.storeInfo.name} ${store.storeInfo.address}`,
                `„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ ${store.storeInfo.address}`,
                `starbucks ${store.storeInfo.address}`,
                `${store.storeInfo.name} ${store.storeInfo.prefecture}`
            ];

            let bestMatch = null;
            let bestConfidence = 0;
            const allSuggestions = [];

            for (const query of queries) {
                try {
                    const placesResult = await searchPlacesAPI(query);
                    if (placesResult && placesResult.length > 0) {
                        for (const place of placesResult.slice(0, 3)) { // ‰∏ä‰Ωç3‰ª∂„ÇíË©ï‰æ°
                            const confidence = calculateMatchConfidence(store, place);
                            allSuggestions.push({ ...place, confidence, query });
                            
                            if (confidence > bestConfidence) {
                                bestMatch = place;
                                bestConfidence = confidence;
                            }
                        }
                    }
                } catch (error) {
                    console.log(`PlacesÊ§úÁ¥¢Â§±Êïó (${query}):`, error.message);
                }
            }

            // Ëá™ÂãïÈÅ©Áî®„ÅÆÈñæÂÄ§Âà§ÂÆö
            if (bestConfidence >= 0.8) {
                // È´ò„ÅÑ‰ø°È†ºÂ∫¶ - Ëá™ÂãïÈÅ©Áî®
                applyPlacesDataToStore(store, bestMatch);
                return { success: true, confidence: bestConfidence };
            } else if (bestConfidence >= 0.4) {
                // ‰∏≠Á®ãÂ∫¶„ÅÆ‰ø°È†ºÂ∫¶ - ÊâãÂãïË™øÊï¥Êé®Â•®
                return {
                    success: false,
                    needsManualAdjustment: true,
                    reason: `‰ø°È†ºÂ∫¶„Åå‰∏≠Á®ãÂ∫¶ (${(bestConfidence * 100).toFixed(1)}%)`,
                    suggestions: allSuggestions.sort((a, b) => b.confidence - a.confidence).slice(0, 3)
                };
            } else {
                // ‰Ωé„ÅÑ‰ø°È†ºÂ∫¶ - ‰øùÁïô
                return {
                    success: false,
                    needsManualAdjustment: true,
                    reason: bestMatch ? `‰ø°È†ºÂ∫¶„Åå‰Ωé„ÅÑ (${(bestConfidence * 100).toFixed(1)}%)` : '„Éû„ÉÉ„ÉÅ„Åô„ÇãÂ∫óËàó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì',
                    suggestions: allSuggestions.slice(0, 3)
                };
            }
        }

        // Places API Ê§úÁ¥¢ („É¢„ÉÉ„ÇØÂÆüË£Ö)
        async function searchPlacesAPI(query) {
            // ÂÆüÈöõ„ÅÆÂÆüË£Ö„Åß„ÅØ Google Places API „Çí‰ΩøÁî®
            // „Åì„Åì„Åß„ÅØ„É¢„ÉÉ„ÇØÂÆüË£Ö
            console.log(`Places API Ê§úÁ¥¢: ${query}`);
            
            // „É¢„ÉÉ„ÇØ„Éá„Éº„Çø„ÇíËøî„Åô
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve([
                        {
                            name: query.includes('Ê∏ãË∞∑') ? '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ Ê∏ãË∞∑„Çπ„ÇØ„É©„É≥„Éñ„É´„Çπ„ÇØ„Ç®„Ç¢Â∫ó' : '„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ „ÉÜ„Çπ„ÉàÂ∫ó',
                            formatted_address: query.includes('Ê∏ãË∞∑') ? 'Êù±‰∫¨ÈÉΩÊ∏ãË∞∑Âå∫Ê∏ãË∞∑2-24-12' : 'Êù±‰∫¨ÈÉΩ„ÉÜ„Çπ„ÉàÂå∫1-1-1',
                            geometry: {
                                location: {
                                    lat: () => 35.658581 + (Math.random() - 0.5) * 0.01,
                                    lng: () => 139.701762 + (Math.random() - 0.5) * 0.01
                                }
                            },
                            formatted_phone_number: '03-1234-5678',
                            opening_hours: {
                                weekday_text: ['ÊúàÊõúÊó•: 6:30-22:30', 'ÁÅ´ÊõúÊó•: 6:30-22:30']
                            },
                            rating: 4.2,
                            types: ['cafe', 'store']
                        }
                    ]);
                }, 100);
            });
        }

        // „Éû„ÉÉ„ÉÅ„É≥„Ç∞‰ø°È†ºÂ∫¶Ë®àÁÆó
        function calculateMatchConfidence(store, place) {
            let confidence = 0;

            // Â∫óËàóÂêç„ÅÆÈ°û‰ººÂ∫¶ (ÊúÄÈáçË¶Å)
            const nameScore = calculateStringSimilarity(
                store.storeInfo.name.toLowerCase(),
                place.name.toLowerCase()
            );
            confidence += nameScore * 0.5;

            // ‰ΩèÊâÄ„ÅÆÈ°û‰ººÂ∫¶
            const addressScore = calculateStringSimilarity(
                store.storeInfo.address,
                place.formatted_address
            );
            confidence += addressScore * 0.3;

            // „Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„ÇπÈñ¢ÈÄ£„Ç≠„Éº„ÉØ„Éº„Éâ
            if (place.name.toLowerCase().includes('starbucks') || 
                place.name.toLowerCase().includes('„Çπ„Çø„Éº„Éê„ÉÉ„ÇØ„Çπ')) {
                confidence += 0.2;
            }

            return Math.min(confidence, 1.0);
        }

        // ÊñáÂ≠óÂàóÈ°û‰ººÂ∫¶Ë®àÁÆó (Á∞°ÊòìÁâà)
        function calculateStringSimilarity(str1, str2) {
            if (!str1 || !str2) return 0;
            
            const commonChars = str1.split('').filter(char => str2.includes(char)).length;
            const maxLength = Math.max(str1.length, str2.length);
            
            return commonChars / maxLength;
        }

        // Places „Éá„Éº„Çø„ÇíÂ∫óËàó„Å´ÈÅ©Áî®
        function applyPlacesDataToStore(store, placesData) {
            // Â∫ßÊ®ôÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            if (placesData.geometry && placesData.geometry.location) {
                store.storeInfo.coordinates = {
                    latitude: placesData.geometry.location.lat(),
                    longitude: placesData.geometry.location.lng()
                };
            }

            // „Éì„Ç∏„Éç„ÇπÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            if (placesData.formatted_phone_number) {
                store.businessInfo.phone = placesData.formatted_phone_number;
            }

            if (placesData.opening_hours && placesData.opening_hours.weekday_text) {
                store.businessInfo.hours = placesData.opening_hours.weekday_text[0] || null;
            }

            // ËøΩÂä†ÊÉÖÂ†±
            if (placesData.rating) {
                store.businessInfo.rating = placesData.rating;
            }

            // Âü∫Êú¨ÁöÑ„Å™Ë®≠ÂÇôÊÉÖÂ†±„ÇíÊé®ÂÆö
            if (!store.businessInfo.features || store.businessInfo.features.length === 0) {
                store.businessInfo.features = ['Wi-Fi', 'Á¶ÅÁÖô']; // „Éá„Éï„Ç©„É´„ÉàË®≠ÂÇô
            }
        }

        // ÊâãÂãïË™øÊï¥„É™„Çπ„ÉàÊõ¥Êñ∞
        function updateManualAdjustmentList(needsAdjustment) {
            const container = document.getElementById('manualAdjustmentList');
            
            if (needsAdjustment.length === 0) {
                container.innerHTML = '<p style="color: #28a745; text-align: center;">‚úÖ ÊâãÂãïË™øÊï¥„ÅåÂøÖË¶Å„Å™Â∫óËàó„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                return;
            }

            container.innerHTML = needsAdjustment.map((item, idx) => `
                <div class="manual-adjustment-item" id="adjustment-${item.index}">
                    <h4>${item.store.storeInfo.name}</h4>
                    <p><strong>‰ΩèÊâÄ:</strong> ${item.store.storeInfo.address}</p>
                    <div class="adjustment-reason">
                        <strong>ÁêÜÁî±:</strong> ${item.reason}
                    </div>
                    
                    ${item.suggestions.length > 0 ? `
                        <h5>üîç ÂÄôË£úÂ∫óËàó</h5>
                        ${item.suggestions.map((suggestion, suggestionIdx) => `
                            <div class="places-suggestion">
                                <h5>${suggestion.name}</h5>
                                <p>${suggestion.formatted_address}</p>
                                <span class="confidence-score ${getConfidenceClass(suggestion.confidence)}">
                                    ‰ø°È†ºÂ∫¶: ${(suggestion.confidence * 100).toFixed(1)}%
                                </span>
                                <div style="margin-top: 0.5rem;">
                                    <button class="btn" onclick="applyManualSuggestion(${item.index}, ${suggestionIdx}, ${idx})" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;">
                                        ‚úÖ ÈÅ©Áî®
                                    </button>
                                    <button class="btn-secondary btn" onclick="rejectSuggestion(${item.index}, ${suggestionIdx})" style="font-size: 0.8rem; padding: 0.3rem 0.8rem;">
                                        ‚ùå Âç¥‰∏ã
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    ` : ''}
                    
                    <div class="adjustment-controls">
                        <button class="btn-secondary btn" onclick="skipManualAdjustment(${item.index})">
                            ‚è≠Ô∏è „Çπ„Ç≠„ÉÉ„Éó
                        </button>
                        <button class="btn" onclick="editStoreManually(${item.index})">
                            ‚úèÔ∏è ÊâãÂãïÁ∑®ÈõÜ
                        </button>
                        <button class="btn-danger btn" onclick="removeStoreFromAdjustment(${item.index})">
                            üóëÔ∏è ÂâäÈô§
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ‰ø°È†ºÂ∫¶„ÇØ„É©„ÇπÂèñÂæó
        function getConfidenceClass(confidence) {
            if (confidence >= 0.7) return 'confidence-high';
            if (confidence >= 0.4) return 'confidence-medium';
            return 'confidence-low';
        }

        // ÊâãÂãïË™øÊï¥Êìç‰Ωú
        function applyManualSuggestion(storeIndex, suggestionIndex, adjustmentIndex) {
            const adjustmentItems = document.querySelectorAll('.manual-adjustment-item');
            const adjustmentData = adjustmentItems[adjustmentIndex];
            
            // ÂÄôË£ú„ÇíÈÅ©Áî®
            // ÂÆüË£Ö„ÅØÁ∞°Áï•Âåñ
            showGlobalStatus('‚úÖ ÂÄôË£ú„ÇíÈÅ©Áî®„Åó„Åæ„Åó„Åü', 'success');
            document.getElementById(`adjustment-${storeIndex}`).remove();
            updateStoreList();
        }

        function skipManualAdjustment(storeIndex) {
            if (confirm('„Åì„ÅÆÂ∫óËàó„ÅÆË™øÊï¥„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åô„ÅãÔºü')) {
                document.getElementById(`adjustment-${storeIndex}`).remove();
                showGlobalStatus('‚è≠Ô∏è Ë™øÊï¥„Çí„Çπ„Ç≠„ÉÉ„Éó„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        function editStoreManually(storeIndex) {
            const store = stores[storeIndex];
            
            // „Éï„Ç©„Éº„É†„Å´Â∫óËàó„Éá„Éº„Çø„ÇíË®≠ÂÆö
            document.getElementById('storeName').value = store.storeInfo.name;
            document.getElementById('storeAddress').value = store.storeInfo.address;
            document.getElementById('storePrefecture').value = store.storeInfo.prefecture;
            document.getElementById('storePhone').value = store.businessInfo.phone || '';
            document.getElementById('storeHours').value = store.businessInfo.hours || '';
            document.getElementById('latitude').value = store.storeInfo.coordinates.latitude || '';
            document.getElementById('longitude').value = store.storeInfo.coordinates.longitude || '';
            document.getElementById('storeFeatures').value = store.businessInfo.features.join(', ');
            
            // ÂÖÉ„ÅÆÂ∫óËàó„ÇíÂâäÈô§
            stores.splice(storeIndex, 1);
            updateStoreList();
            updateStats();
            
            showGlobalStatus('‚úèÔ∏è ÊâãÂãïÁ∑®ÈõÜÁî®„Å´„Éï„Ç©„Éº„É†„Å´Ë™≠„ÅøËæº„Åø„Åæ„Åó„Åü', 'success');
            document.getElementById(`adjustment-${storeIndex}`).remove();
        }

        function removeStoreFromAdjustment(storeIndex) {
            if (confirm('„Åì„ÅÆÂ∫óËàó„ÇíÂÆåÂÖ®„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                stores.splice(storeIndex, 1);
                updateStoreList();
                updateStats();
                document.getElementById(`adjustment-${storeIndex}`).remove();
                showGlobalStatus('üóëÔ∏è Â∫óËàó„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü', 'success');
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„ÅÆÂàùÊúüÂåñ
        window.addEventListener('load', function() {
            console.log('üöÄ Store List Creator Tool initialized');
            updateStats();
        });
    </script>

    <!-- Google Maps API (API„Ç≠„Éº„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ) -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcx2v4xS9VuQjHzhME5Fz3Uazig3l62RI&libraries=geometry&callback=initMap">
    </script>
</body>
</html>