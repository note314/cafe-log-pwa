<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafeâ˜…Log - å…¬å¼ã‚µã‚¤ãƒˆåº—èˆ—ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #00704A;
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .panel {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .panel h2 {
            color: #00704A;
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
            border-bottom: 3px solid #00704A;
            padding-bottom: 0.5rem;
        }

        .btn {
            background: #00704A;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.2s;
            margin: 0.5rem;
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            background: #005a38;
            transform: translateY(-1px);
        }

        .btn-large {
            width: 100%;
            padding: 1.5rem;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .progress-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00704A, #28a745);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-display {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 4px solid #00704A;
        }

        .status-display.loading {
            border-left-color: #ffc107;
            background: #fff8e1;
        }

        .status-display.success {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .status-display.error {
            border-left-color: #dc3545;
            background: #fff5f5;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e9ecef;
            transition: all 0.2s;
        }

        .stat-card:hover {
            border-color: #00704A;
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #00704A;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }

        .prefecture-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 1rem;
            background: #f8f9fa;
        }

        .prefecture-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            margin: 0.25rem 0;
            background: white;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .prefecture-status {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pending {
            background: #e9ecef;
            color: #6c757d;
        }

        .status-processing {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d4edda;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
        }

        .extraction-log {
            background: #000;
            color: #00ff00;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            height: 200px;
            overflow-y: auto;
            margin: 1rem 0;
        }

        .store-preview {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .store-item {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            border-left: 4px solid #00704A;
        }

        .store-name {
            font-weight: 600;
            color: #00704A;
            margin-bottom: 0.25rem;
        }

        .store-address {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 0.25rem;
        }

        .store-coordinates {
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: #007bff;
        }

        .api-config {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .api-config h4 {
            color: #856404;
            margin-bottom: 0.5rem;
        }

        .hidden {
            display: none;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #00704A;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #dc3545;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¢ å…¬å¼ã‚µã‚¤ãƒˆåº—èˆ—ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºãƒ„ãƒ¼ãƒ«</h1>
            <p>ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰æ­£ç¢ºãªåº—èˆ—æƒ…å ±ã‚’è‡ªå‹•å–å¾—ã—ã€é«˜ç²¾åº¦åº§æ¨™ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ</p>
        </div>

        <div class="main-content">
            <!-- æŠ½å‡ºåˆ¶å¾¡ãƒ‘ãƒãƒ« -->
            <div class="panel">
                <h2>ğŸ“¡ ãƒ‡ãƒ¼ã‚¿æŠ½å‡º</h2>
                
                <div class="api-config">
                    <h4>ğŸ”‘ APIè¨­å®šç¢ºèª</h4>
                    <p style="font-size: 0.9rem; margin: 0;">
                        å…¬å¼API: <code>store.starbucks.co.jp</code><br>
                        Geocoding: Google Maps API
                    </p>
                </div>

                <button class="btn btn-large btn-success" onclick="startFullExtraction()">
                    ğŸš€ å…¨åº—èˆ—ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºé–‹å§‹
                </button>

                <button class="btn btn-large btn-secondary" onclick="testSinglePrefecture()">
                    ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆ1éƒ½é“åºœçœŒï¼‰
                </button>

                <button class="btn btn-large btn-warning" onclick="testAPIConnection()">
                    ğŸ”Œ APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
                </button>

                <button class="btn btn-large" onclick="manualDataInput()" style="background: #6f42c1;">
                    âœï¸ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰
                </button>

                <button class="btn btn-large" onclick="showCORSWorkaround()" style="background: #e74c3c;">
                    ğŸ› ï¸ CORSå•é¡Œè§£æ±ºæ–¹æ³•
                </button>

                <div class="progress-section hidden" id="extractionProgress">
                    <h4>ğŸ“Š æŠ½å‡ºé€²æ—</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill">0%</div>
                    </div>
                    <div class="status-display" id="currentStatus">
                        å¾…æ©Ÿä¸­...
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalExtracted">0</div>
                        <div class="stat-label">æŠ½å‡ºæ¸ˆã¿åº—èˆ—</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="successfulGeocode">0</div>
                        <div class="stat-label">åº§æ¨™å–å¾—æˆåŠŸ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="failedGeocode">0</div>
                        <div class="stat-label">åº§æ¨™å–å¾—å¤±æ•—</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="completedPrefectures">0</div>
                        <div class="stat-label">å®Œäº†éƒ½é“åºœçœŒ</div>
                    </div>
                </div>

                <button class="btn btn-warning" onclick="pauseExtraction()" id="pauseBtn" disabled>
                    â¸ï¸ ä¸€æ™‚åœæ­¢
                </button>
                <button class="btn btn-secondary" onclick="resumeExtraction()" id="resumeBtn" disabled>
                    â–¶ï¸ å†é–‹
                </button>
                <button class="btn btn-secondary" onclick="stopExtraction()" id="stopBtn" disabled>
                    â¹ï¸ åœæ­¢
                </button>
            </div>

            <!-- é€²æ—ç›£è¦–ãƒ‘ãƒãƒ« -->
            <div class="panel">
                <h2>ğŸ“‹ éƒ½é“åºœçœŒåˆ¥é€²æ—</h2>
                
                <div class="prefecture-list" id="prefectureList">
                    <!-- å‹•çš„ã«ç”Ÿæˆ -->
                </div>

                <h3 style="margin-top: 1.5rem;">ğŸ“œ å®Ÿè¡Œãƒ­ã‚°</h3>
                <div class="extraction-log" id="extractionLog">
                    > ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­...<br>
                </div>
            </div>
        </div>

        <!-- æŠ½å‡ºçµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
        <div class="store-preview">
            <h2>ğŸ‘€ æŠ½å‡ºçµæœãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
            <div id="storePreviewContainer">
                <p style="text-align: center; color: #666; margin: 2rem 0;">
                    æŠ½å‡ºé–‹å§‹å¾Œã«ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                </p>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <button class="btn btn-success" onclick="exportToJSON()" id="exportBtn" disabled>
                    ğŸ’¾ JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
                </button>
                <button class="btn btn-secondary" onclick="clearAllData()">
                    ğŸ—‘ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
                </button>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let extractedStores = [];
        let extractionStatus = {
            isRunning: false,
            isPaused: false,
            currentPrefecture: 0,
            totalPrefectures: 47, // PREFECTURE_DATAã®é•·ã•ã§å¾Œã‹ã‚‰æ›´æ–°
            stats: {
                totalExtracted: 0,
                successfulGeocode: 0,
                failedGeocode: 0,
                completedPrefectures: 0
            }
        };

        let geocoder = null;

        // éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ï¼ˆæ­£ç¢ºãªURLä»˜ãï¼‰
        const PREFECTURE_DATA = [
            { name: 'åŒ—æµ·é“', slug: 'hokkaido', url: 'https://store.starbucks.co.jp/pref/hokkaido/' },
            { name: 'é’æ£®çœŒ', slug: 'aomori', url: 'https://store.starbucks.co.jp/pref/aomori/' },
            { name: 'å²©æ‰‹çœŒ', slug: 'iwate', url: 'https://store.starbucks.co.jp/pref/iwate/' },
            { name: 'å®®åŸçœŒ', slug: 'miyagi', url: 'https://store.starbucks.co.jp/pref/miyagi/' },
            { name: 'ç§‹ç”°çœŒ', slug: 'akita', url: 'https://store.starbucks.co.jp/pref/akita/' },
            { name: 'å±±å½¢çœŒ', slug: 'yamagata', url: 'https://store.starbucks.co.jp/pref/yamagata/' },
            { name: 'ç¦å³¶çœŒ', slug: 'fukushima', url: 'https://store.starbucks.co.jp/pref/fukushima/' },
            { name: 'èŒ¨åŸçœŒ', slug: 'ibaraki', url: 'https://store.starbucks.co.jp/pref/ibaraki/' },
            { name: 'æ ƒæœ¨çœŒ', slug: 'tochigi', url: 'https://store.starbucks.co.jp/pref/tochigi/' },
            { name: 'ç¾¤é¦¬çœŒ', slug: 'gunma', url: 'https://store.starbucks.co.jp/pref/gunma/' },
            { name: 'åŸ¼ç‰çœŒ', slug: 'saitama', url: 'https://store.starbucks.co.jp/pref/saitama/' },
            { name: 'åƒè‘‰çœŒ', slug: 'chiba', url: 'https://store.starbucks.co.jp/pref/chiba/' },
            { name: 'æ±äº¬éƒ½', slug: 'tokyo', url: 'https://store.starbucks.co.jp/pref/tokyo/' },
            { name: 'ç¥å¥ˆå·çœŒ', slug: 'kanagawa', url: 'https://store.starbucks.co.jp/pref/kanagawa/' },
            { name: 'æ–°æ½ŸçœŒ', slug: 'niigata', url: 'https://store.starbucks.co.jp/pref/niigata/' },
            { name: 'å¯Œå±±çœŒ', slug: 'toyama', url: 'https://store.starbucks.co.jp/pref/toyama/' },
            { name: 'çŸ³å·çœŒ', slug: 'ishikawa', url: 'https://store.starbucks.co.jp/pref/ishikawa/' },
            { name: 'ç¦äº•çœŒ', slug: 'fukui', url: 'https://store.starbucks.co.jp/pref/fukui/' },
            { name: 'å±±æ¢¨çœŒ', slug: 'yamanashi', url: 'https://store.starbucks.co.jp/pref/yamanashi/' },
            { name: 'é•·é‡çœŒ', slug: 'nagano', url: 'https://store.starbucks.co.jp/pref/nagano/' },
            { name: 'å²é˜œçœŒ', slug: 'gifu', url: 'https://store.starbucks.co.jp/pref/gifu/' },
            { name: 'é™å²¡çœŒ', slug: 'shizuoka', url: 'https://store.starbucks.co.jp/pref/shizuoka/' },
            { name: 'æ„›çŸ¥çœŒ', slug: 'aichi', url: 'https://store.starbucks.co.jp/pref/aichi/' },
            { name: 'ä¸‰é‡çœŒ', slug: 'mie', url: 'https://store.starbucks.co.jp/pref/mie/' },
            { name: 'æ»‹è³€çœŒ', slug: 'shiga', url: 'https://store.starbucks.co.jp/pref/shiga/' },
            { name: 'äº¬éƒ½åºœ', slug: 'kyoto', url: 'https://store.starbucks.co.jp/pref/kyoto/' },
            { name: 'å¤§é˜ªåºœ', slug: 'osaka', url: 'https://store.starbucks.co.jp/pref/osaka/' },
            { name: 'å…µåº«çœŒ', slug: 'hyogo', url: 'https://store.starbucks.co.jp/pref/hyogo/' },
            { name: 'å¥ˆè‰¯çœŒ', slug: 'nara', url: 'https://store.starbucks.co.jp/pref/nara/' },
            { name: 'å’Œæ­Œå±±çœŒ', slug: 'wakayama', url: 'https://store.starbucks.co.jp/pref/wakayama/' },
            { name: 'é³¥å–çœŒ', slug: 'tottori', url: 'https://store.starbucks.co.jp/pref/tottori/' },
            { name: 'å³¶æ ¹çœŒ', slug: 'shimane', url: 'https://store.starbucks.co.jp/pref/shimane/' },
            { name: 'å²¡å±±çœŒ', slug: 'okayama', url: 'https://store.starbucks.co.jp/pref/okayama/' },
            { name: 'åºƒå³¶çœŒ', slug: 'hiroshima', url: 'https://store.starbucks.co.jp/pref/hiroshima/' },
            { name: 'å±±å£çœŒ', slug: 'yamaguchi', url: 'https://store.starbucks.co.jp/pref/yamaguchi/' },
            { name: 'å¾³å³¶çœŒ', slug: 'tokushima', url: 'https://store.starbucks.co.jp/pref/tokushima/' },
            { name: 'é¦™å·çœŒ', slug: 'kagawa', url: 'https://store.starbucks.co.jp/pref/kagawa/' },
            { name: 'æ„›åª›çœŒ', slug: 'ehime', url: 'https://store.starbucks.co.jp/pref/ehime/' },
            { name: 'é«˜çŸ¥çœŒ', slug: 'kochi', url: 'https://store.starbucks.co.jp/pref/kochi/' },
            { name: 'ç¦å²¡çœŒ', slug: 'fukuoka', url: 'https://store.starbucks.co.jp/pref/fukuoka/' },
            { name: 'ä½è³€çœŒ', slug: 'saga', url: 'https://store.starbucks.co.jp/pref/saga/' },
            { name: 'é•·å´çœŒ', slug: 'nagasaki', url: 'https://store.starbucks.co.jp/pref/nagasaki/' },
            { name: 'ç†Šæœ¬çœŒ', slug: 'kumamoto', url: 'https://store.starbucks.co.jp/pref/kumamoto/' },
            { name: 'å¤§åˆ†çœŒ', slug: 'oita', url: 'https://store.starbucks.co.jp/pref/oita/' },
            { name: 'å®®å´çœŒ', slug: 'miyazaki', url: 'https://store.starbucks.co.jp/pref/miyazaki/' },
            { name: 'é¹¿å…å³¶çœŒ', slug: 'kagoshima', url: 'https://store.starbucks.co.jp/pref/kagoshima/' },
            { name: 'æ²–ç¸„çœŒ', slug: 'okinawa', url: 'https://store.starbucks.co.jp/pref/okinawa/' }
        ];

        // ä¸‹ä½äº’æ›ã®ãŸã‚
        const PREFECTURES = PREFECTURE_DATA.map(p => p.name);

        // éƒ½é“åºœçœŒâ†’ã‚¨ãƒªã‚¢ãƒãƒƒãƒ”ãƒ³ã‚°
        const PREFECTURE_TO_AREA = {
            'åŒ—æµ·é“': 'åŒ—æµ·é“',
            'é’æ£®çœŒ': 'æ±åŒ—', 'å²©æ‰‹çœŒ': 'æ±åŒ—', 'å®®åŸçœŒ': 'æ±åŒ—', 'ç§‹ç”°çœŒ': 'æ±åŒ—', 'å±±å½¢çœŒ': 'æ±åŒ—', 'ç¦å³¶çœŒ': 'æ±åŒ—',
            'èŒ¨åŸçœŒ': 'é–¢æ±', 'æ ƒæœ¨çœŒ': 'é–¢æ±', 'ç¾¤é¦¬çœŒ': 'é–¢æ±', 'åŸ¼ç‰çœŒ': 'é–¢æ±', 'åƒè‘‰çœŒ': 'é–¢æ±', 'æ±äº¬éƒ½': 'é–¢æ±', 'ç¥å¥ˆå·çœŒ': 'é–¢æ±',
            'æ–°æ½ŸçœŒ': 'ä¸­éƒ¨', 'å¯Œå±±çœŒ': 'ä¸­éƒ¨', 'çŸ³å·çœŒ': 'ä¸­éƒ¨', 'ç¦äº•çœŒ': 'ä¸­éƒ¨', 'å±±æ¢¨çœŒ': 'ä¸­éƒ¨', 'é•·é‡çœŒ': 'ä¸­éƒ¨', 'å²é˜œçœŒ': 'ä¸­éƒ¨', 'é™å²¡çœŒ': 'ä¸­éƒ¨', 'æ„›çŸ¥çœŒ': 'ä¸­éƒ¨',
            'ä¸‰é‡çœŒ': 'è¿‘ç•¿', 'æ»‹è³€çœŒ': 'è¿‘ç•¿', 'äº¬éƒ½åºœ': 'è¿‘ç•¿', 'å¤§é˜ªåºœ': 'è¿‘ç•¿', 'å…µåº«çœŒ': 'è¿‘ç•¿', 'å¥ˆè‰¯çœŒ': 'è¿‘ç•¿', 'å’Œæ­Œå±±çœŒ': 'è¿‘ç•¿',
            'é³¥å–çœŒ': 'ä¸­å›½', 'å³¶æ ¹çœŒ': 'ä¸­å›½', 'å²¡å±±çœŒ': 'ä¸­å›½', 'åºƒå³¶çœŒ': 'ä¸­å›½', 'å±±å£çœŒ': 'ä¸­å›½',
            'å¾³å³¶çœŒ': 'å››å›½', 'é¦™å·çœŒ': 'å››å›½', 'æ„›åª›çœŒ': 'å››å›½', 'é«˜çŸ¥çœŒ': 'å››å›½',
            'ç¦å²¡çœŒ': 'ä¹å·', 'ä½è³€çœŒ': 'ä¹å·', 'é•·å´çœŒ': 'ä¹å·', 'ç†Šæœ¬çœŒ': 'ä¹å·', 'å¤§åˆ†çœŒ': 'ä¹å·', 'å®®å´çœŒ': 'ä¹å·', 'é¹¿å…å³¶çœŒ': 'ä¹å·', 'æ²–ç¸„çœŒ': 'ä¹å·'
        };

        // Google Maps APIåˆæœŸåŒ–
        function initMap() {
            geocoder = new google.maps.Geocoder();
            logMessage('âœ… Google Maps API initialized');
        }

        // åˆæœŸåŒ–
        function init() {
            // éƒ½é“åºœçœŒæ•°ã‚’æ›´æ–°
            extractionStatus.totalPrefectures = PREFECTURE_DATA.length;
            
            createPrefectureList();
            logMessage('ğŸš€ Official Store Extractor Tool initialized');
            logMessage(`ğŸ“Š å¯¾è±¡éƒ½é“åºœçœŒ: ${PREFECTURE_DATA.length}ä»¶`);
        }

        // éƒ½é“åºœçœŒãƒªã‚¹ãƒˆä½œæˆ
        function createPrefectureList() {
            const container = document.getElementById('prefectureList');
            container.innerHTML = PREFECTURE_DATA.map((prefData, index) => `
                <div class="prefecture-item" id="prefecture-${index}">
                    <span>${prefData.name}</span>
                    <span class="prefecture-status status-pending" id="status-${index}">å¾…æ©Ÿä¸­</span>
                </div>
            `).join('');
        }

        // ãƒ•ãƒ«æŠ½å‡ºé–‹å§‹
        async function startFullExtraction() {
            if (extractionStatus.isRunning) {
                logMessage('âŒ æ—¢ã«æŠ½å‡ºãŒå®Ÿè¡Œä¸­ã§ã™');
                return;
            }

            if (!geocoder) {
                logMessage('âŒ Google Maps APIãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            const confirmed = confirm(
                `å…¨éƒ½é“åºœçœŒï¼ˆ${PREFECTURE_DATA.length}ä»¶ï¼‰ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã™ã‹ï¼Ÿ\n\n` +
                'âš ï¸ æ³¨æ„äº‹é …:\n' +
                'â€¢ å‡¦ç†ã«ã¯20-30åˆ†ç¨‹åº¦ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™\n' +
                'â€¢ å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰ç›´æ¥ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¾ã™\n' +
                'â€¢ é€”ä¸­ã§ä¸€æ™‚åœæ­¢ãƒ»å†é–‹ãŒå¯èƒ½ã§ã™'
            );

            if (!confirmed) return;

            logMessage('ğŸš€ å…¨åº—èˆ—ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã‚’é–‹å§‹...');
            resetStats();
            showProgress();
            enableControls();

            extractionStatus.isRunning = true;
            extractionStatus.currentPrefecture = 0;

            try {
                for (let i = 0; i < PREFECTURE_DATA.length; i++) {
                    if (!extractionStatus.isRunning) {
                        logMessage('â¹ï¸ æŠ½å‡ºãŒåœæ­¢ã•ã‚Œã¾ã—ãŸ');
                        break;
                    }

                    while (extractionStatus.isPaused) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }

                    extractionStatus.currentPrefecture = i;
                    await processPrefecture(PREFECTURE_DATA[i].name, i);
                    
                    // è² è·è»½æ¸›ã®ãŸã‚ã®å¾…æ©Ÿ
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }

                if (extractionStatus.isRunning) {
                    logMessage('âœ… å…¨éƒ½é“åºœçœŒã®æŠ½å‡ºãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                    updateStatus('æŠ½å‡ºå®Œäº†ï¼', 'success');
                    enableExport();
                }

            } catch (error) {
                logMessage(`âŒ æŠ½å‡ºã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                extractionStatus.isRunning = false;
                disableControls();
            }
        }

        // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå˜ä¸€éƒ½é“åºœçœŒï¼‰
        async function testSinglePrefecture() {
            if (extractionStatus.isRunning) {
                logMessage('âŒ æ—¢ã«æŠ½å‡ºãŒå®Ÿè¡Œä¸­ã§ã™');
                return;
            }

            const testPrefecture = 'æ±äº¬éƒ½';
            logMessage(`ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: ${testPrefecture}`);
            
            showProgress();
            extractionStatus.isRunning = true;

            try {
                await processPrefecture(testPrefecture, 12); // æ±äº¬éƒ½ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
                logMessage('âœ… ãƒ†ã‚¹ãƒˆå®Œäº†');
                updateStatus('ãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
                enableExport();
            } catch (error) {
                logMessage(`âŒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateStatus(`ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
            } finally {
                extractionStatus.isRunning = false;
            }
        }

        // éƒ½é“åºœçœŒåˆ¥å‡¦ç†
        async function processPrefecture(prefecture, index) {
            logMessage(`ğŸ“ å‡¦ç†é–‹å§‹: ${prefecture}`);
            updatePrefectureStatus(index, 'processing');
            updateStatus(`${prefecture} ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...`, 'loading');

            try {
                // å…¬å¼APIã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—
                const officialStores = await fetchOfficialStores(prefecture);
                logMessage(`  â†’ ${officialStores.length}åº—èˆ—ã‚’å–å¾—`);

                // å„åº—èˆ—ã®åº§æ¨™ã‚’å–å¾—
                let successCount = 0;
                let failCount = 0;

                for (let i = 0; i < officialStores.length; i++) {
                    const store = officialStores[i];
                    updateStatus(`${prefecture} ${i + 1}/${officialStores.length}: ${store.name}`, 'loading');

                    try {
                        const coordinates = await getCoordinatesFromAddress(store.address);
                        
                        if (coordinates) {
                            const enrichedStore = {
                                storeInfo: {
                                    id: generateStoreId(store.name, prefecture),
                                    name: store.name,
                                    address: store.address,
                                    coordinates: coordinates,
                                    prefecture: prefecture,
                                    city: extractCity(store.address),
                                    area: PREFECTURE_TO_AREA[prefecture] || 'ä¸æ˜'
                                },
                                businessInfo: {
                                    hours: store.hours || null,
                                    phone: store.phone || null,
                                    features: ['Wi-Fi', 'é›»æº', 'ç¦ç…™'] // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å‚™
                                },
                                extractionInfo: {
                                    source: 'official',
                                    extractedAt: new Date().toISOString(),
                                    geocodingAccuracy: coordinates.accuracy || 'unknown'
                                }
                            };

                            extractedStores.push(enrichedStore);
                            successCount++;
                            extractionStatus.stats.successfulGeocode++;
                            
                            logMessage(`    âœ… ${store.name}: åº§æ¨™å–å¾—æˆåŠŸ`);
                        } else {
                            failCount++;
                            extractionStatus.stats.failedGeocode++;
                            logMessage(`    âŒ ${store.name}: åº§æ¨™å–å¾—å¤±æ•—`);
                        }

                        extractionStatus.stats.totalExtracted++;
                        updateStats();
                        updatePreview();

                        // Geocoding APIåˆ¶é™å¯¾ç­–
                        await new Promise(resolve => setTimeout(resolve, 100));

                    } catch (geoError) {
                        failCount++;
                        extractionStatus.stats.failedGeocode++;
                        logMessage(`    âŒ ${store.name}: ${geoError.message}`);
                    }
                }

                updatePrefectureStatus(index, 'completed');
                extractionStatus.stats.completedPrefectures++;
                
                logMessage(`âœ… ${prefecture} å®Œäº†: æˆåŠŸ ${successCount}ä»¶ã€å¤±æ•— ${failCount}ä»¶`);
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
                const progress = ((index + 1) / PREFECTURE_DATA.length) * 100;
                updateProgress(progress);

            } catch (error) {
                updatePrefectureStatus(index, 'error');
                logMessage(`âŒ ${prefecture} ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                throw error;
            }
        }

        // å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆHTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ï¼‰
        async function fetchOfficialStores(prefecture) {
            logMessage(`  ğŸŒ å…¬å¼ã‚µã‚¤ãƒˆå–å¾—: ${prefecture}`);
            
            // éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢
            const prefData = PREFECTURE_DATA.find(p => p.name === prefecture);
            if (!prefData) {
                throw new Error(`éƒ½é“åºœçœŒãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${prefecture}`);
            }
            
            return await scrapeStoresFromPrefecturePage(prefData);
        }

        // éƒ½é“åºœçœŒãƒšãƒ¼ã‚¸ã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
        async function scrapeStoresFromPrefecturePage(prefData) {
            logMessage(`  ğŸ“„ ãƒšãƒ¼ã‚¸è§£æ: ${prefData.url}`);
            
            try {
                // è¤‡æ•°ã®ãƒ—ãƒ­ã‚­ã‚·ã‚’é †ç•ªã«è©¦è¡Œï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ ï¼‰
                const corsWorkarounds = [
                    // AllOrigins with headers
                    { 
                        url: `https://api.allorigins.win/get?url=${encodeURIComponent(prefData.url)}`,
                        options: {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                            }
                        }
                    },
                    // Proxy with custom headers
                    { 
                        url: `https://corsproxy.io/?${encodeURIComponent(prefData.url)}`,
                        options: {
                            headers: {
                                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
                            }
                        }
                    },
                    // Manual data input fallback
                    { url: 'manual', manual: true }
                ];
                
                let html = null;
                
                for (let i = 0; i < corsWorkarounds.length; i++) {
                    const workaround = corsWorkarounds[i];
                    try {
                        logMessage(`    ğŸ”„ è©¦è¡Œ ${i + 1}/${corsWorkarounds.length}: ${workaround.url.split('?')[0].split('/').pop()}`);
                        
                        const response = await fetch(workaround.url);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        let data = await response.text();
                        
                        // AllOriginsã®å ´åˆã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å±•é–‹
                        if (workaround.url.includes('allorigins.win')) {
                            try {
                                const jsonData = JSON.parse(data);
                                if (jsonData.contents) {
                                    data = jsonData.contents;
                                }
                            } catch (e) {
                                logMessage(`    âŒ AllOriginsãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æå¤±æ•—: ${e.message}`);
                                continue;
                            }
                        }
                        
                        html = data;
                        logMessage(`    âœ… HTMLå–å¾—æˆåŠŸ: ${workaround.url.split('?')[0].split('/').pop()}`);
                        break;
                        
                    } catch (error) {
                        logMessage(`    âŒ è©¦è¡Œ ${i + 1} å¤±æ•—: ${error.message}`);
                        if (i === corsWorkarounds.length - 1) {
                            throw new Error(`å…¨ã¦ã® CORS å›é¿æ‰‹æ®µãŒå¤±æ•—: ${error.message}`);
                        }
                    }
                }
                
                if (!html) {
                    throw new Error('HTMLã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
                }
                
                // HTMLã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
                const stores = parseStoresFromHTML(html, prefData);
                logMessage(`  âœ… ${stores.length}åº—èˆ—ã‚’æŠ½å‡º: ${prefData.name}`);
                
                return stores;
                
            } catch (error) {
                logMessage(`  âŒ ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                throw error;
            }
        }

        // HTMLã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’è§£æ
        function parseStoresFromHTML(html, prefData) {
            logMessage(`    ğŸ” HTMLè§£æé–‹å§‹...`);
            
            const stores = [];
            
            // ä»®æƒ³çš„ãªDOMãƒ‘ãƒ¼ã‚µãƒ¼ã¨ã—ã¦ä½¿ç”¨ï¼ˆå®Ÿéš›ã®HTMLãƒ‘ãƒ¼ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            
            // åº—èˆ—æƒ…å ±ã‚’å«ã‚€è¦ç´ ã‚’æ¤œç´¢ï¼ˆè¤‡æ•°ã®å¯èƒ½ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’è©¦è¡Œï¼‰
            const possibleSelectors = [
                '.store-list .store-item',
                '.shop-list .shop-item', 
                '.shop_list .shop_item',
                '.store_list .store_item',
                'article.store',
                'div.store',
                '.store-info',
                '.shop-info',
                'li[data-store]',
                '.store-block'
            ];
            
            let storeElements = [];
            
            for (const selector of possibleSelectors) {
                storeElements = doc.querySelectorAll(selector);
                if (storeElements.length > 0) {
                    logMessage(`    âœ… åº—èˆ—è¦ç´ ç™ºè¦‹: ${selector} (${storeElements.length}ä»¶)`);
                    break;
                }
            }
            
            if (storeElements.length === 0) {
                // ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã§è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã€ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã§æŠ½å‡º
                logMessage(`    ğŸ”„ ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹æŠ½å‡ºã‚’è©¦è¡Œ...`);
                return parseStoresFromText(html, prefData);
            }
            
            // å„åº—èˆ—è¦ç´ ã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡º
            storeElements.forEach((element, index) => {
                try {
                    const storeData = extractStoreDataFromElement(element, prefData);
                    if (storeData.name && storeData.address) {
                        stores.push(storeData);
                        logMessage(`    ğŸ“ ${index + 1}: ${storeData.name}`);
                    }
                } catch (e) {
                    logMessage(`    âŒ åº—èˆ—${index + 1}ã®è§£æã«å¤±æ•—: ${e.message}`);
                }
            });
            
            return stores;
        }

        // DOMè¦ç´ ã‹ã‚‰åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
        function extractStoreDataFromElement(element, prefData) {
            const storeData = {
                name: '',
                address: '',
                hours: null,
                phone: null
            };
            
            // åº—èˆ—åæŠ½å‡ºï¼ˆè¤‡æ•°ã®ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’è©¦è¡Œï¼‰
            const nameSelectors = ['.store-name', '.shop-name', '.name', 'h3', 'h4', '.title'];
            for (const selector of nameSelectors) {
                const nameEl = element.querySelector(selector);
                if (nameEl && nameEl.textContent.trim()) {
                    storeData.name = nameEl.textContent.trim();
                    break;
                }
            }
            
            // ä½æ‰€æŠ½å‡º
            const addressSelectors = ['.store-address', '.shop-address', '.address', '.addr'];
            for (const selector of addressSelectors) {
                const addressEl = element.querySelector(selector);
                if (addressEl && addressEl.textContent.trim()) {
                    storeData.address = addressEl.textContent.trim();
                    break;
                }
            }
            
            // å–¶æ¥­æ™‚é–“æŠ½å‡º
            const hoursSelectors = ['.store-hours', '.hours', '.time', '.business-hours'];
            for (const selector of hoursSelectors) {
                const hoursEl = element.querySelector(selector);
                if (hoursEl && hoursEl.textContent.trim()) {
                    storeData.hours = hoursEl.textContent.trim();
                    break;
                }
            }
            
            // é›»è©±ç•ªå·æŠ½å‡º
            const phoneSelectors = ['.store-phone', '.phone', '.tel'];
            for (const selector of phoneSelectors) {
                const phoneEl = element.querySelector(selector);
                if (phoneEl && phoneEl.textContent.trim()) {
                    storeData.phone = phoneEl.textContent.trim();
                    break;
                }
            }
            
            return storeData;
        }

        // ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã§ã®åº—èˆ—ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
        function parseStoresFromText(html, prefData) {
            logMessage(`    ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆè§£æãƒ¢ãƒ¼ãƒ‰`);
            
            const stores = [];
            
            // ã€Œâ—‹â—‹åº—ã€ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢
            const storeNamePattern = /([^ã€‚\n]*?åº—)/g;
            const storeMatches = html.match(storeNamePattern) || [];
            
            logMessage(`    ğŸ” åº—åå€™è£œ: ${storeMatches.length}ä»¶`);
            
            // ä½æ‰€ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œç´¢ï¼ˆéƒ½é“åºœçœŒåã‚’å«ã‚€ä½æ‰€ï¼‰
            const addressPattern = new RegExp(`(${prefData.name}[^ã€‚\\n]*?)(?=[ã€‚\\n]|$)`, 'g');
            const addressMatches = html.match(addressPattern) || [];
            
            logMessage(`    ğŸ” ä½æ‰€å€™è£œ: ${addressMatches.length}ä»¶`);
            
            // åº—åã¨ä½æ‰€ã‚’ãƒšã‚¢ãƒªãƒ³ã‚°
            const minLength = Math.min(storeMatches.length, addressMatches.length);
            for (let i = 0; i < minLength; i++) {
                const name = storeMatches[i].trim();
                const address = addressMatches[i].trim();
                
                if (name && address && name !== address) {
                    stores.push({
                        name: name,
                        address: address,
                        hours: null,
                        phone: null
                    });
                }
            }
            
            return stores;
        }

        // APIã‚¯ã‚¨ãƒªå®Ÿè¡Œ
        async function fetchStoresByQuery(apiBase, params) {
            const queryParams = new URLSearchParams();
            
            // åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            queryParams.append('limit', '100');
            queryParams.append('offset', '0');
            
            // æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
            Object.keys(params).forEach(key => {
                if (params[key]) {
                    queryParams.append(key, params[key]);
                }
            });
            
            const targetUrl = `${apiBase}?${queryParams.toString()}`;
            logMessage(`    ğŸ“¡ APIå‘¼ã³å‡ºã—: ${targetUrl}`);
            
            // CORSå¯¾ç­–: è¤‡æ•°ã®ãƒ—ãƒ­ã‚­ã‚·ã‚’é †ç•ªã«è©¦è¡Œ
            const corsWorkarounds = [
                // ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆCORSè¨±å¯ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
                { url: targetUrl, options: { mode: 'cors' } },
                // AllOrigins
                { url: `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}` },
                // ThingProxy
                { url: `https://thingproxy.freeboard.io/fetch/${targetUrl}` },
                // cors-anywhere (æœ€å¾Œã®æ‰‹æ®µ)
                { url: `https://cors-anywhere.herokuapp.com/${targetUrl}`, 
                  options: { headers: { 'X-Requested-With': 'XMLHttpRequest', 'Origin': 'https://store.starbucks.co.jp' } } }
            ];
            
            for (let i = 0; i < corsWorkarounds.length; i++) {
                const workaround = corsWorkarounds[i];
                try {
                    logMessage(`    ğŸ”„ è©¦è¡Œ ${i + 1}/${corsWorkarounds.length}: ${workaround.url.split('?')[0]}`);
                    
                    const response = await fetch(workaround.url, workaround.options || {});
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    
                    let data = await response.json();
                    
                    // AllOriginsã®å ´åˆã€ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å±•é–‹
                    if (data.contents) {
                        try {
                            data = JSON.parse(data.contents);
                        } catch (e) {
                            logMessage(`    âŒ AllOriginsãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æå¤±æ•—: ${e.message}`);
                            continue;
                        }
                    }
                    
                    logMessage(`    âœ… APIæˆåŠŸ: ${workaround.url.split('?')[0].split('/').pop()}`);
                    return parseAPIResponse(data);
                    
                } catch (error) {
                    logMessage(`    âŒ è©¦è¡Œ ${i + 1} å¤±æ•—: ${error.message}`);
                    if (i === corsWorkarounds.length - 1) {
                        throw new Error(`å…¨ã¦ã® CORS å›é¿æ‰‹æ®µãŒå¤±æ•—: ${error.message}`);
                    }
                }
            }
        }

        // APIãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æ
        function parseAPIResponse(data) {
            // è©³ç´°ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ åˆ†æ
            logMessage('    ğŸ” ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ è§£æä¸­...');
            analyzeResponseStructure(data);
            
            // è¤‡æ•°ã®å¯èƒ½ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã«å¯¾å¿œ
            let stores = [];
            
            if (data.stores) {
                stores = data.stores;
                logMessage(`    âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼: data.stores (${stores.length}ä»¶)`);
            } else if (data.results) {
                stores = data.results;
                logMessage(`    âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼: data.results (${stores.length}ä»¶)`);
            } else if (data.data) {
                stores = data.data;
                logMessage(`    âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼: data.data (${stores.length}ä»¶)`);
            } else if (data.Items) {
                stores = data.Items;
                logMessage(`    âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼: data.Items (${stores.length}ä»¶)`);
            } else if (data.response && data.response.items) {
                stores = data.response.items;
                logMessage(`    âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼: data.response.items (${stores.length}ä»¶)`);
            } else if (Array.isArray(data)) {
                stores = data;
                logMessage(`    âœ… ãƒ‡ãƒ¼ã‚¿å½¢å¼: é…åˆ— (${stores.length}ä»¶)`);
            } else {
                logMessage('    âš ï¸ æœªçŸ¥ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ');
                console.log('API Response:', data);
                return [];
            }
            
            const parsedStores = stores.map(store => ({
                name: extractStoreName(store),
                address: extractStoreAddress(store),
                hours: extractStoreHours(store),
                phone: extractStorePhone(store),
                services: extractStoreServices(store)
            })).filter(store => store.name && store.address);
            
            logMessage(`    ğŸ“Š è§£æçµæœ: ${parsedStores.length}/${stores.length}ä»¶ãŒæœ‰åŠ¹`);
            return parsedStores;
        }

        // ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ è©³ç´°åˆ†æ
        function analyzeResponseStructure(data) {
            const analysis = {
                type: typeof data,
                isArray: Array.isArray(data),
                keys: Object.keys(data || {}),
                sampleData: {}
            };
            
            // ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã‚­ãƒ¼åˆ†æ
            if (typeof data === 'object' && data !== null) {
                analysis.keys.forEach(key => {
                    const value = data[key];
                    analysis.sampleData[key] = {
                        type: typeof value,
                        isArray: Array.isArray(value),
                        length: Array.isArray(value) ? value.length : undefined,
                        keys: typeof value === 'object' && value !== null && !Array.isArray(value) ? Object.keys(value) : undefined
                    };
                });
            }
            
            logMessage(`    ğŸ“‹ æ§‹é€ åˆ†æ: ${JSON.stringify(analysis, null, 2)}`);
            
            // messageãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å†…å®¹ã‚’è©³ç´°è¡¨ç¤º
            if (data && data.message) {
                logMessage(`    ğŸ’¬ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹: "${data.message}"`);
                
                // messageãŒJSONã®å¯èƒ½æ€§ã‚‚ãƒã‚§ãƒƒã‚¯
                try {
                    const messageAsJson = JSON.parse(data.message);
                    logMessage(`    ğŸ”„ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯JSONå½¢å¼ã§ã—ãŸ`);
                    logMessage(`    ğŸ“‹ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸JSONæ§‹é€ : ${JSON.stringify(messageAsJson, null, 2)}`);
                } catch (e) {
                    logMessage(`    ğŸ“ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ`);
                }
            }
            
            // å¯èƒ½ãªåº—èˆ—ãƒ‡ãƒ¼ã‚¿ã®å ´æ‰€ã‚’æ¨æ¸¬
            const possibleStoreArrays = [];
            if (data && typeof data === 'object') {
                Object.keys(data).forEach(key => {
                    const value = data[key];
                    if (Array.isArray(value) && value.length > 0) {
                        possibleStoreArrays.push({
                            key: key,
                            length: value.length,
                            sampleItem: value[0]
                        });
                    }
                });
            }
            
            if (possibleStoreArrays.length > 0) {
                logMessage(`    ğŸ¯ åº—èˆ—ãƒ‡ãƒ¼ã‚¿å€™è£œ: ${possibleStoreArrays.map(arr => `${arr.key}(${arr.length}ä»¶)`).join(', ')}`);
                possibleStoreArrays.forEach(arr => {
                    logMessage(`    ğŸ“ ${arr.key}ã®ã‚µãƒ³ãƒ—ãƒ«: ${JSON.stringify(arr.sampleItem, null, 2)}`);
                });
            } else {
                logMessage('    âŒ é…åˆ—å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                
                // å…¨ã¦ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å€¤ã‚’è¡¨ç¤ºï¼ˆãƒ‡ãƒãƒƒã‚°ï¼‰
                if (data && typeof data === 'object') {
                    Object.keys(data).forEach(key => {
                        const value = data[key];
                        if (typeof value === 'string' && value.length < 200) {
                            logMessage(`    ğŸ” ${key}: "${value}"`);
                        } else if (typeof value === 'object') {
                            logMessage(`    ğŸ” ${key}: ${JSON.stringify(value)}`);
                        }
                    });
                }
            }
        }

        // åº—èˆ—æƒ…å ±æŠ½å‡ºãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function extractStoreName(store) {
            return store.name || store.shop_name || store.storeName || store.title || '';
        }

        function extractStoreAddress(store) {
            return store.address || store.full_address || store.addr || store.location || '';
        }

        function extractStoreHours(store) {
            return store.hours || store.business_hours || store.openHours || store.time || null;
        }

        function extractStorePhone(store) {
            return store.phone || store.tel || store.telephone || store.contact || null;
        }

        function extractStoreServices(store) {
            const services = store.services || store.amenities || store.features || [];
            return Array.isArray(services) ? services : [];
        }

        // éƒ½é“åºœçœŒã‚³ãƒ¼ãƒ‰å–å¾—
        function getPrefectureCode(prefecture) {
            const prefectureCodes = {
                'åŒ—æµ·é“': '01', 'é’æ£®çœŒ': '02', 'å²©æ‰‹çœŒ': '03', 'å®®åŸçœŒ': '04', 'ç§‹ç”°çœŒ': '05',
                'å±±å½¢çœŒ': '06', 'ç¦å³¶çœŒ': '07', 'èŒ¨åŸçœŒ': '08', 'æ ƒæœ¨çœŒ': '09', 'ç¾¤é¦¬çœŒ': '10',
                'åŸ¼ç‰çœŒ': '11', 'åƒè‘‰çœŒ': '12', 'æ±äº¬éƒ½': '13', 'ç¥å¥ˆå·çœŒ': '14', 'æ–°æ½ŸçœŒ': '15',
                'å¯Œå±±çœŒ': '16', 'çŸ³å·çœŒ': '17', 'ç¦äº•çœŒ': '18', 'å±±æ¢¨çœŒ': '19', 'é•·é‡çœŒ': '20',
                'å²é˜œçœŒ': '21', 'é™å²¡çœŒ': '22', 'æ„›çŸ¥çœŒ': '23', 'ä¸‰é‡çœŒ': '24', 'æ»‹è³€çœŒ': '25',
                'äº¬éƒ½åºœ': '26', 'å¤§é˜ªåºœ': '27', 'å…µåº«çœŒ': '28', 'å¥ˆè‰¯çœŒ': '29', 'å’Œæ­Œå±±çœŒ': '30',
                'é³¥å–çœŒ': '31', 'å³¶æ ¹çœŒ': '32', 'å²¡å±±çœŒ': '33', 'åºƒå³¶çœŒ': '34', 'å±±å£çœŒ': '35',
                'å¾³å³¶çœŒ': '36', 'é¦™å·çœŒ': '37', 'æ„›åª›çœŒ': '38', 'é«˜çŸ¥çœŒ': '39', 'ç¦å²¡çœŒ': '40',
                'ä½è³€çœŒ': '41', 'é•·å´çœŒ': '42', 'ç†Šæœ¬çœŒ': '43', 'å¤§åˆ†çœŒ': '44', 'å®®å´çœŒ': '45',
                'é¹¿å…å³¶çœŒ': '46', 'æ²–ç¸„çœŒ': '47'
            };
            return prefectureCodes[prefecture] || null;
        }

        // é‡è¤‡åº—èˆ—é™¤å»
        function removeDuplicateStores(stores) {
            const seen = new Set();
            return stores.filter(store => {
                const key = `${store.name}_${store.address}`;
                if (seen.has(key)) {
                    return false;
                }
                seen.add(key);
                return true;
            });
        }

        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°
        async function fallbackHTMLScraping(prefecture) {
            logMessage(`    ğŸ”„ HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚° ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ${prefecture}`);
            
            try {
                // ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã§å…¬å¼ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
                const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
                const targetUrl = `https://store.starbucks.co.jp/?nid=mm&prefecture=${encodeURIComponent(prefecture)}`;
                
                const response = await fetch(proxyUrl + targetUrl);
                const html = await response.text();
                
                // HTMLã‹ã‚‰JavaScriptã®åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
                const scriptMatches = html.match(/<script[^>]*>([\s\S]*?)<\/script>/gi);
                const stores = [];
                
                for (const script of scriptMatches || []) {
                    // åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€JSONã‚’æ¢ã™
                    const jsonMatches = script.match(/(\{[\s\S]*?"stores"[\s\S]*?\})/g);
                    for (const jsonMatch of jsonMatches || []) {
                        try {
                            const data = JSON.parse(jsonMatch);
                            if (data.stores) {
                                stores.push(...parseAPIResponse(data));
                            }
                        } catch (e) {
                            // JSONè§£æå¤±æ•—ã¯ç„¡è¦–
                        }
                    }
                }
                
                logMessage(`    ğŸ“„ HTMLè§£æçµæœ: ${stores.length}åº—èˆ—`);
                return stores;
                
            } catch (error) {
                logMessage(`    âŒ HTMLã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°å¤±æ•—: ${error.message}`);
                return [];
            }
        }

        // ä½æ‰€ã‹ã‚‰åº§æ¨™å–å¾—
        async function getCoordinatesFromAddress(address) {
            return new Promise((resolve, reject) => {
                geocoder.geocode({ address: address, region: 'JP' }, (results, status) => {
                    if (status === 'OK' && results.length > 0) {
                        const result = results[0];
                        const location = result.geometry.location;
                        
                        // ç²¾åº¦åˆ¤å®š
                        let accuracy = 'medium';
                        switch (result.geometry.location_type) {
                            case 'ROOFTOP': accuracy = 'high'; break;
                            case 'RANGE_INTERPOLATED': accuracy = 'medium'; break;
                            case 'GEOMETRIC_CENTER': accuracy = 'low'; break;
                            case 'APPROXIMATE': accuracy = 'very_low'; break;
                        }

                        resolve({
                            latitude: location.lat(),
                            longitude: location.lng(),
                            accuracy: accuracy,
                            formatted_address: result.formatted_address
                        });
                    } else {
                        reject(new Error(`Geocoding failed: ${status}`));
                    }
                });
            });
        }

        // åº—èˆ—IDç”Ÿæˆ
        function generateStoreId(storeName, prefecture) {
            const prefCode = prefecture.replace(/[éƒ½é“åºœçœŒ]/g, '');
            const storeCode = storeName
                .replace(/ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹|ã‚³ãƒ¼ãƒ’ãƒ¼|åº—/g, '')
                .replace(/[^ã-ã‚“ã‚¡-ãƒ¶ä¸€-é¾¯a-zA-Z0-9]/g, '_')
                .toLowerCase();
            
            const timestamp = Date.now().toString().slice(-6);
            return `store_${prefCode}_${storeCode}_${timestamp}`;
        }

        // å¸‚åŒºç”ºæ‘æŠ½å‡º
        function extractCity(address) {
            const cityMatch = address.match(/([^éƒ½é“åºœçœŒ]+[éƒ½é“åºœçœŒ])(.+?[å¸‚åŒºç”ºæ‘])/);
            return cityMatch ? cityMatch[2] : '';
        }

        // UIæ›´æ–°é–¢æ•°ç¾¤
        function updateProgress(percentage) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${percentage}%`;
            progressFill.textContent = `${percentage.toFixed(1)}%`;
        }

        function updateStatus(message, type = 'loading') {
            const statusElement = document.getElementById('currentStatus');
            statusElement.textContent = message;
            statusElement.className = `status-display ${type}`;
        }

        function updatePrefectureStatus(index, status) {
            const statusElement = document.getElementById(`status-${index}`);
            const statusText = {
                'pending': 'å¾…æ©Ÿä¸­',
                'processing': 'å‡¦ç†ä¸­',
                'completed': 'å®Œäº†',
                'error': 'ã‚¨ãƒ©ãƒ¼'
            };
            
            statusElement.textContent = statusText[status];
            statusElement.className = `prefecture-status status-${status}`;
        }

        function updateStats() {
            document.getElementById('totalExtracted').textContent = extractionStatus.stats.totalExtracted;
            document.getElementById('successfulGeocode').textContent = extractionStatus.stats.successfulGeocode;
            document.getElementById('failedGeocode').textContent = extractionStatus.stats.failedGeocode;
            document.getElementById('completedPrefectures').textContent = extractionStatus.stats.completedPrefectures;
        }

        function updatePreview() {
            const container = document.getElementById('storePreviewContainer');
            const recentStores = extractedStores.slice(-5); // æœ€æ–°5ä»¶ã‚’è¡¨ç¤º
            
            if (recentStores.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ã¾ã ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
                return;
            }

            container.innerHTML = `
                <p style="margin-bottom: 1rem; color: #666;">æœ€æ–°ã®æŠ½å‡ºçµæœï¼ˆ${recentStores.length}ä»¶ / å…¨${extractedStores.length}ä»¶ï¼‰</p>
                ${recentStores.map(store => `
                    <div class="store-item">
                        <div class="store-name">${store.storeInfo.name}</div>
                        <div class="store-address">ğŸ“ ${store.storeInfo.address}</div>
                        <div class="store-coordinates">
                            åº§æ¨™: ${store.storeInfo.coordinates.latitude.toFixed(6)}, ${store.storeInfo.coordinates.longitude.toFixed(6)}
                            (ç²¾åº¦: ${store.extractionInfo.geocodingAccuracy})
                        </div>
                    </div>
                `).join('')}
            `;
        }

        function logMessage(message) {
            const logContainer = document.getElementById('extractionLog');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `<span style="color: #888;">[${timestamp}]</span> ${message}<br>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function showProgress() {
            document.getElementById('extractionProgress').classList.remove('hidden');
        }

        function enableControls() {
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('stopBtn').disabled = false;
        }

        function disableControls() {
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('resumeBtn').disabled = true;
            document.getElementById('stopBtn').disabled = true;
        }

        function enableExport() {
            document.getElementById('exportBtn').disabled = false;
        }

        function resetStats() {
            extractionStatus.stats = {
                totalExtracted: 0,
                successfulGeocode: 0,
                failedGeocode: 0,
                completedPrefectures: 0
            };
            updateStats();
        }

        // åˆ¶å¾¡æ©Ÿèƒ½
        function pauseExtraction() {
            extractionStatus.isPaused = true;
            document.getElementById('pauseBtn').disabled = true;
            document.getElementById('resumeBtn').disabled = false;
            logMessage('â¸ï¸ æŠ½å‡ºã‚’ä¸€æ™‚åœæ­¢ã—ã¾ã—ãŸ');
            updateStatus('ä¸€æ™‚åœæ­¢ä¸­...', 'warning');
        }

        function resumeExtraction() {
            extractionStatus.isPaused = false;
            document.getElementById('pauseBtn').disabled = false;
            document.getElementById('resumeBtn').disabled = true;
            logMessage('â–¶ï¸ æŠ½å‡ºã‚’å†é–‹ã—ã¾ã—ãŸ');
        }

        function stopExtraction() {
            extractionStatus.isRunning = false;
            extractionStatus.isPaused = false;
            disableControls();
            logMessage('â¹ï¸ æŠ½å‡ºã‚’åœæ­¢ã—ã¾ã—ãŸ');
            updateStatus('åœæ­¢ã•ã‚Œã¾ã—ãŸ', 'error');
        }

        // ãƒ‡ãƒ¼ã‚¿ç®¡ç†
        function exportToJSON() {
            if (extractedStores.length === 0) {
                alert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            const exportData = {
                metadata: {
                    dataVersion: {
                        current: "2.1.0",
                        compatible: ["2.0.0", "2.1.0"]
                    },
                    generatedAt: new Date().toISOString(),
                    totalStores: extractedStores.length,
                    coverage: `å…¨å›½${extractionStatus.stats.completedPrefectures}éƒ½é“åºœçœŒ`,
                    generator: 'Cafeâ˜…Log Official Store Extractor',
                    extractionStats: {
                        totalExtracted: extractionStatus.stats.totalExtracted,
                        successfulGeocode: extractionStatus.stats.successfulGeocode,
                        failedGeocode: extractionStatus.stats.failedGeocode,
                        geocodingSuccessRate: (extractionStatus.stats.successfulGeocode / extractionStatus.stats.totalExtracted * 100).toFixed(1) + '%'
                    }
                },
                stores: extractedStores,
                migrationSupport: {
                    legacyIdMapping: {},
                    deprecatedFields: []
                }
            };

            // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cafe-log-official-stores-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            logMessage(`ğŸ’¾ ${extractedStores.length}åº—èˆ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
        }

        function clearAllData() {
            if (extractionStatus.isRunning) {
                alert('æŠ½å‡ºä¸­ã¯ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã§ãã¾ã›ã‚“');
                return;
            }

            if (extractedStores.length > 0 && !confirm('å…¨ã¦ã®æŠ½å‡ºãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            extractedStores = [];
            resetStats();
            updatePreview();
            document.getElementById('exportBtn').disabled = true;
            
            // éƒ½é“åºœçœŒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒªã‚»ãƒƒãƒˆ
            PREFECTURES.forEach((_, index) => {
                updatePrefectureStatus(index, 'pending');
            });

            updateProgress(0);
            updateStatus('ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢å®Œäº†', 'success');
            logMessage('ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ');
        }

        // APIæ¥ç¶šãƒ†ã‚¹ãƒˆ
        async function testAPIConnection() {
            logMessage('ğŸ”Œ APIæ¥ç¶šãƒ†ã‚¹ãƒˆã‚’é–‹å§‹...');
            updateStatus('APIæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...', 'loading');
            
            const API_BASE = 'https://hn8madehag.execute-api.ap-northeast-1.amazonaws.com/prd-2019-08-21/storesearch';
            
            // è¤‡æ•°ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã‚’ãƒ†ã‚¹ãƒˆ
            const testMethods = [
                {
                    name: 'ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹',
                    url: API_BASE,
                    options: {}
                },
                {
                    name: 'CORS Anywhereãƒ—ãƒ­ã‚­ã‚·',
                    url: 'https://cors-anywhere.herokuapp.com/' + API_BASE,
                    options: {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    }
                },
                {
                    name: 'AllOriginsãƒ—ãƒ­ã‚­ã‚·',
                    url: `https://api.allorigins.win/get?url=${encodeURIComponent(API_BASE)}`,
                    options: {}
                }
            ];
            
            for (const method of testMethods) {
                try {
                    logMessage(`  ğŸ“¡ ãƒ†ã‚¹ãƒˆä¸­: ${method.name}`);
                    
                    const response = await fetch(method.url, method.options);
                    
                    if (response.ok) {
                        const text = await response.text();
                        logMessage(`  âœ… ${method.name}: æˆåŠŸ (${response.status})`);
                        logMessage(`    ğŸ“„ ãƒ¬ã‚¹ãƒãƒ³ã‚¹é•·: ${text.length} chars`);
                        
                        // JSONã¨ã—ã¦è§£æã‚’è©¦è¡Œ
                        try {
                            const data = JSON.parse(text);
                            logMessage(`    ğŸ“Š JSONè§£æ: æˆåŠŸ`);
                            console.log('API Response Sample:', data);
                        } catch (e) {
                            logMessage(`    ğŸ“Š JSONè§£æ: å¤±æ•— (HTML responses?)`);
                        }
                        
                        break; // æˆåŠŸã—ãŸã‚‰ä»–ã®ãƒ†ã‚¹ãƒˆã¯ä¸è¦
                    } else {
                        logMessage(`  âŒ ${method.name}: ${response.status} ${response.statusText}`);
                    }
                    
                } catch (error) {
                    logMessage(`  âŒ ${method.name}: ${error.message}`);
                }
            }
            
            updateStatus('APIæ¥ç¶šãƒ†ã‚¹ãƒˆå®Œäº†', 'success');
        }

        // CORSå•é¡Œã®è§£æ±ºæ–¹æ³•ã‚’è¡¨ç¤º
        function showCORSWorkaround() {
            const workaroundHTML = `
                <div style="max-width: 600px; margin: 20px auto; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h3 style="color: #e74c3c;">ğŸ› ï¸ CORSåˆ¶é™å›é¿æ–¹æ³•</h3>
                    
                    <h4>æ–¹æ³•1: ãƒ–ãƒ©ã‚¦ã‚¶æ‹¡å¼µæ©Ÿèƒ½ã‚’ä½¿ç”¨</h4>
                    <p>
                        Chrome/Edge: "CORS Unblock" æ‹¡å¼µæ©Ÿèƒ½ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«<br>
                        Firefox: "CORS Everywhere" ã‚¢ãƒ‰ã‚ªãƒ³ã‚’ä½¿ç”¨
                    </p>
                    
                    <h4>æ–¹æ³•2: é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨</h4>
                    <ol>
                        <li>æ–°ã—ã„ã‚¿ãƒ–ã§ https://store.starbucks.co.jp/pref/tokyo/ ã‚’é–‹ã</li>
                        <li>F12ã‚’æŠ¼ã—ã¦é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã</li>
                        <li>Console ã‚¿ãƒ–ã«ä»¥ä¸‹ã‚’è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ:</li>
                    </ol>
                    <textarea readonly style="width: 100%; height: 100px; font-family: monospace;">
// åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã™ã‚‹ã‚³ãƒ¼ãƒ‰
const stores = [];
document.querySelectorAll('.store-item, .shop-item').forEach(item => {
    const name = item.querySelector('.name, .store-name')?.textContent?.trim();
    const address = item.querySelector('.address, .store-address')?.textContent?.trim();
    if (name && address) stores.push(name + '|' + address);
});
console.log(stores.join('\\n'));
                    </textarea>
                    
                    <h4>æ–¹æ³•3: æ‰‹å‹•ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ</h4>
                    <p>
                        1. å…¬å¼ã‚µã‚¤ãƒˆã‹ã‚‰åº—èˆ—æƒ…å ±ã‚’ã‚³ãƒ”ãƒ¼<br>
                        2. "âœï¸ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰" ãƒœã‚¿ãƒ³ã‚’ä½¿ç”¨<br>
                        3. ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢ã—ã¦å…¥åŠ›
                    </p>
                    
                    <button onclick="this.parentElement.remove()" style="margin-top: 10px; padding: 5px 10px;">é–‰ã˜ã‚‹</button>
                </div>
            `;
            
            // æ—¢å­˜ã®èª¬æ˜ã‚’å‰Šé™¤
            const existing = document.querySelector('.cors-workaround');
            if (existing) existing.remove();
            
            // æ–°ã—ã„èª¬æ˜ã‚’è¿½åŠ 
            const div = document.createElement('div');
            div.className = 'cors-workaround';
            div.innerHTML = workaroundHTML;
            document.body.appendChild(div);
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            div.scrollIntoView({ behavior: 'smooth' });
        }

        // æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ¡ãƒ¢å¸³ã‹ã‚‰ã®ä¸€æ‹¬å…¥åŠ›å¯¾å¿œï¼‰
        function manualDataInput() {
            showBulkInputDialog();
        }

        // ä¸€æ‹¬å…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º
        function showBulkInputDialog() {
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’ä½œæˆ
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
                background: rgba(0,0,0,0.5); z-index: 10000; 
                display: flex; justify-content: center; align-items: center;
            `;
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 800px; max-height: 90vh; overflow-y: auto;">
                    <h2 style="margin-top: 0; color: #00704A;">ğŸ“ å…¨åº—èˆ—ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬å…¥åŠ›</h2>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <h4>ğŸ“‹ å…¥åŠ›å½¢å¼ï¼ˆãƒ¡ãƒ¢å¸³ç”¨ï¼‰</h4>
                        <p style="margin: 10px 0;">
                            <strong>1è¡Œã«ã¤ã1åº—èˆ—ï¼š</strong><br>
                            åº—èˆ—å|ä½æ‰€<br><br>
                            <strong>ä¾‹ï¼š</strong><br>
                            ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ æ¸‹è°·ã‚¹ã‚«ã‚¤åº—|æ±äº¬éƒ½æ¸‹è°·åŒºæ¸‹è°·2-24-12<br>
                            ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ æ–°å®¿å—å£åº—|æ±äº¬éƒ½æ–°å®¿åŒºæ–°å®¿3-38-1
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 10px; font-weight: bold;">
                            åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼š
                        </label>
                        <textarea id="bulkStoreData" 
                            style="width: 100%; height: 300px; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-family: monospace; font-size: 14px;"
                            placeholder="ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ åº—èˆ—å|éƒ½é“åºœçœŒ å¸‚åŒºç”ºæ‘ è©³ç´°ä½æ‰€&#10;ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹ åº—èˆ—å|éƒ½é“åºœçœŒ å¸‚åŒºç”ºæ‘ è©³ç´°ä½æ‰€&#10;..."></textarea>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="margin-right: 10px;">
                            <input type="checkbox" id="includeCoordinates" checked> 
                            ä½æ‰€ã‹ã‚‰åº§æ¨™ã‚’è‡ªå‹•å–å¾—ã™ã‚‹ï¼ˆGoogle Maps APIä½¿ç”¨ï¼‰
                        </label>
                    </div>
                    
                    <div style="text-align: center;">
                        <button onclick="processBulkStoreData()" 
                            style="background: #00704A; color: white; padding: 12px 30px; border: none; border-radius: 6px; font-size: 16px; margin-right: 10px; cursor: pointer;">
                            âœ… ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
                        </button>
                        <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" 
                            style="background: #6c757d; color: white; padding: 12px 30px; border: none; border-radius: 6px; font-size: 16px; cursor: pointer;">
                            âŒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                        </button>
                    </div>
                    
                    <div id="processingStatus" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; display: none;">
                        <div id="statusText">å‡¦ç†ä¸­...</div>
                        <div style="width: 100%; height: 20px; background: #eee; border-radius: 10px; margin-top: 10px;">
                            <div id="progressBar" style="height: 100%; background: #00704A; border-radius: 10px; width: 0%; transition: width 0.3s;"></div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // ä¸€æ‹¬åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†
        async function processBulkStoreData() {
            const textarea = document.getElementById('bulkStoreData');
            const includeCoords = document.getElementById('includeCoordinates').checked;
            const statusDiv = document.getElementById('processingStatus');
            const statusText = document.getElementById('statusText');
            const progressBar = document.getElementById('progressBar');
            
            const rawData = textarea.value.trim();
            if (!rawData) {
                alert('ãƒ‡ãƒ¼ã‚¿ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
                return;
            }
            
            statusDiv.style.display = 'block';
            statusText.textContent = 'ãƒ‡ãƒ¼ã‚¿ã‚’è§£æä¸­...';
            
            // ãƒ‡ãƒ¼ã‚¿ã‚’è¡Œã”ã¨ã«åˆ†å‰²ã—ã¦è§£æ
            const lines = rawData.split('\n').filter(line => line.trim());
            const stores = [];
            
            let processed = 0;
            
            for (const line of lines) {
                try {
                    processed++;
                    const progress = (processed / lines.length) * 100;
                    progressBar.style.width = progress + '%';
                    
                    // åº—èˆ—åã¨ä½æ‰€ã‚’åˆ†é›¢
                    const parts = line.trim().split('|');
                    if (parts.length < 2) {
                        statusText.textContent = `è¡Œ ${processed}: å½¢å¼ã‚¨ãƒ©ãƒ¼ - ã‚¹ã‚­ãƒƒãƒ—`;
                        await new Promise(resolve => setTimeout(resolve, 100));
                        continue;
                    }
                    
                    const storeName = parts[0].trim();
                    const address = parts[1].trim();
                    
                    statusText.textContent = `å‡¦ç†ä¸­ ${processed}/${lines.length}: ${storeName}`;
                    
                    // éƒ½é“åºœçœŒã‚’ç‰¹å®š
                    const prefecture = extractPrefectureFromAddress(address);
                    const area = PREFECTURE_TO_AREA[prefecture] || 'ä¸æ˜';
                    
                    const storeData = {
                        storeInfo: {
                            id: generateStoreId(storeName, prefecture),
                            name: storeName,
                            address: address,
                            prefecture: prefecture,
                            city: extractCity(address),
                            area: area
                        },
                        businessInfo: {
                            hours: null,
                            phone: null,
                            features: ['Wi-Fi', 'é›»æº', 'ç¦ç…™']
                        },
                        extractionInfo: {
                            source: 'manual',
                            extractedAt: new Date().toISOString(),
                            geocodingAccuracy: 'unknown'
                        }
                    };
                    
                    // åº§æ¨™å–å¾—ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
                    if (includeCoords && geocoder) {
                        try {
                            statusText.textContent = `åº§æ¨™å–å¾—ä¸­ ${processed}/${lines.length}: ${storeName}`;
                            const coordinates = await getCoordinatesFromAddress(address);
                            if (coordinates) {
                                storeData.storeInfo.coordinates = coordinates;
                                storeData.extractionInfo.geocodingAccuracy = coordinates.accuracy;
                            }
                        } catch (e) {
                            // åº§æ¨™å–å¾—ã«å¤±æ•—ã—ã¦ã‚‚ã‚¹ã‚­ãƒƒãƒ—ã›ãšç¶šè¡Œ
                            console.warn(`åº§æ¨™å–å¾—å¤±æ•—: ${storeName}`, e);
                        }
                        
                        // APIåˆ¶é™å¯¾ç­–
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    stores.push(storeData);
                    
                } catch (error) {
                    console.error(`è¡Œ ${processed} ã®å‡¦ç†ã«å¤±æ•—:`, error);
                }
            }
            
            // extractedStoresã«è¿½åŠ 
            extractedStores.push(...stores);
            
            // UIæ›´æ–°
            updateStats();
            updatePreview();
            enableExport();
            
            statusText.textContent = `âœ… å®Œäº†: ${stores.length}åº—èˆ—ã‚’è¿½åŠ ã—ã¾ã—ãŸ`;
            progressBar.style.width = '100%';
            
            logMessage(`ğŸ“ æ‰‹å‹•å…¥åŠ›å®Œäº†: ${stores.length}åº—èˆ—ã‚’è¿½åŠ `);
            
            // 3ç§’å¾Œã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            setTimeout(() => {
                document.querySelector('div[style*="position: fixed"]').remove();
            }, 3000);
        }

        // ä½æ‰€ã‹ã‚‰éƒ½é“åºœçœŒã‚’æŠ½å‡º
        function extractPrefectureFromAddress(address) {
            for (const prefData of PREFECTURE_DATA) {
                if (address.includes(prefData.name)) {
                    return prefData.name;
                }
            }
            return 'ä¸æ˜';
        }
            
            if (!manualData) return;
            
            const lines = manualData.trim().split('\n');
            let addedCount = 0;
            
            for (const line of lines) {
                const parts = line.split('|');
                if (parts.length >= 2) {
                    const store = {
                        name: parts[0].trim(),
                        address: parts[1].trim(),
                        hours: parts[2] ? parts[2].trim() : null,
                        phone: parts[3] ? parts[3].trim() : null
                    };
                    
                    if (store.name && store.address) {
                        // åº§æ¨™å–å¾—ã‚’è©¦è¡Œ
                        getCoordinatesFromAddress(store.address).then(coordinates => {
                            if (coordinates) {
                                const enrichedStore = {
                                    storeInfo: {
                                        id: generateStoreId(store.name, 'æ‰‹å‹•å…¥åŠ›'),
                                        name: store.name,
                                        address: store.address,
                                        coordinates: coordinates,
                                        prefecture: extractPrefecture(store.address),
                                        city: extractCity(store.address),
                                        area: 'manual'
                                    },
                                    businessInfo: {
                                        hours: store.hours,
                                        phone: store.phone,
                                        features: ['Wi-Fi', 'é›»æº', 'ç¦ç…™']
                                    },
                                    extractionInfo: {
                                        source: 'manual',
                                        extractedAt: new Date().toISOString(),
                                        geocodingAccuracy: coordinates.accuracy || 'unknown'
                                    }
                                };
                                
                                extractedStores.push(enrichedStore);
                                extractionStatus.stats.totalExtracted++;
                                extractionStatus.stats.successfulGeocode++;
                                updateStats();
                                updatePreview();
                                
                                logMessage(`âœ… æ‰‹å‹•è¿½åŠ : ${store.name}`);
                            } else {
                                logMessage(`âŒ åº§æ¨™å–å¾—å¤±æ•—: ${store.name}`);
                            }
                        });
                        
                        addedCount++;
                    }
                }
            }
            
            logMessage(`ğŸ“ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿å…¥åŠ›: ${addedCount}åº—èˆ—ã‚’å‡¦ç†ä¸­...`);
            enableExport();
        }

        // ä½æ‰€ã‹ã‚‰éƒ½é“åºœçœŒã‚’æŠ½å‡º
        function extractPrefecture(address) {
            const prefectureMatch = address.match(/(åŒ—æµ·é“|[äº¬å¤§é˜ªå…µåº«å¥ˆè‰¯å’Œæ­Œå±±é³¥å–å³¶æ ¹å²¡å±±åºƒå³¶å±±å£å¾³å³¶é¦™å·æ„›åª›é«˜çŸ¥ç¦å²¡ä½è³€é•·å´ç†Šæœ¬å¤§åˆ†å®®å´é¹¿å…å³¶æ²–ç¸„][éƒ½åºœçœŒ]|[é’å²©å®®ç§‹å±±ç¦èŒ¨æ ƒç¾¤åŸ¼åƒç¥æ–°å¯ŒçŸ³ç¦å±±é•·å²é™æ„›ä¸‰æ»‹äº¬å¤§å…µå¥ˆå’Œé³¥å³¶å²¡åºƒå±±å¾³é¦™æ„›é«˜ç¦ä½é•·ç†Šå¤§å®®é¹¿æ²–][æ£®æ‰‹åŸç”°å½¢å³¶åŸæœ¨é¦¬ç‰è‘‰å¥ˆæ½Ÿå±±å·äº•æ¢¨é‡é˜œå²¡çŸ¥é‡è³€éƒ½é˜ªåº«è‰¯æ­Œå–æ ¹å±±å³¶å£å³¶å·åª›çŸ¥å²¡è³€å´æœ¬åˆ†å´å…ç¸„][çœŒ])/);
            return prefectureMatch ? prefectureMatch[1] : 'ä¸æ˜';
        }

        // ã‚ˆã‚Šæ­£ç¢ºãªAPIãƒ¬ã‚¹ãƒãƒ³ã‚¹è§£æï¼ˆå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«å¯¾å¿œï¼‰
        function parseAPIResponse(data) {
            let stores = [];
            
            // ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹å…¬å¼APIã®å®Ÿéš›ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã‚’æƒ³å®š
            if (data.hits && Array.isArray(data.hits)) {
                stores = data.hits;
            } else if (data.results && Array.isArray(data.results)) {
                stores = data.results;
            } else if (data.stores && Array.isArray(data.stores)) {
                stores = data.stores;
            } else if (data.data && Array.isArray(data.data)) {
                stores = data.data;
            } else if (Array.isArray(data)) {
                stores = data;
            } else {
                logMessage('    âš ï¸ æœªçŸ¥ã®APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ');
                logMessage(`    ğŸ“Š ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ—: ${typeof data}`);
                logMessage(`    ğŸ”‘ ã‚­ãƒ¼ä¸€è¦§: ${Object.keys(data).join(', ')}`);
                console.log('Full API Response:', data);
                
                // ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã‚’è©³ç´°ã«ãƒ­ã‚°å‡ºåŠ›
                analyzeResponseStructure(data);
                
                // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å€¤ã‚’å†å¸°çš„ã«æ¢ç´¢
                stores = findStoreArrayInObject(data);
            }
            
            return stores.map(store => ({
                name: extractStoreName(store),
                address: extractStoreAddress(store),
                hours: extractStoreHours(store),
                phone: extractStorePhone(store),
                services: extractStoreServices(store)
            })).filter(store => store.name && store.address);
        }

        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå†…ã®é…åˆ—ã‚’å†å¸°çš„ã«æ¢ç´¢
        function findStoreArrayInObject(obj, depth = 0) {
            if (depth > 3) return []; // ç„¡é™å†å¸°é˜²æ­¢
            
            for (const key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const value = obj[key];
                    
                    if (Array.isArray(value) && value.length > 0) {
                        // é…åˆ—ã®æœ€åˆã®è¦ç´ ãŒåº—èˆ—ãƒ‡ãƒ¼ã‚¿ã£ã½ã„ã‹ãƒã‚§ãƒƒã‚¯
                        const firstItem = value[0];
                        if (firstItem && typeof firstItem === 'object' && 
                           (firstItem.name || firstItem.shop_name || firstItem.storeName)) {
                            logMessage(`    ğŸ“ åº—èˆ—é…åˆ—ç™ºè¦‹: ${key} (${value.length}ä»¶)`);
                            return value;
                        }
                    } else if (typeof value === 'object' && value !== null) {
                        const result = findStoreArrayInObject(value, depth + 1);
                        if (result.length > 0) return result;
                    }
                }
            }
            
            return [];
        }

        // ã‚ˆã‚ŠæŸ”è»Ÿãªåº—èˆ—æƒ…å ±æŠ½å‡º
        function extractStoreName(store) {
            // è¤‡æ•°ã®å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’è©¦è¡Œ
            const nameFields = ['name', 'shop_name', 'storeName', 'title', 'store_name', 'shopName'];
            for (const field of nameFields) {
                if (store[field] && typeof store[field] === 'string') {
                    return store[field].trim();
                }
            }
            return '';
        }

        function extractStoreAddress(store) {
            // è¤‡æ•°ã®å¯èƒ½ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åã‚’è©¦è¡Œ
            const addressFields = ['address', 'full_address', 'addr', 'location', 'address_full', 'fullAddress'];
            for (const field of addressFields) {
                if (store[field] && typeof store[field] === 'string') {
                    return store[field].trim();
                }
            }
            
            // ä½æ‰€ãŒåˆ†å‰²ã•ã‚Œã¦ã„ã‚‹å ´åˆã®çµ±åˆ
            const prefecture = store.prefecture || store.pref || '';
            const city = store.city || store.municipality || '';
            const street = store.street || store.address1 || '';
            
            if (prefecture && city) {
                return `${prefecture}${city}${street}`.trim();
            }
            
            return '';
        }

        // CORSå¯¾ç­–ã®æ”¹è‰¯ç‰ˆ
        async function fetchStoresByQuery(apiBase, params) {
            const queryParams = new URLSearchParams();
            
            // åŸºæœ¬ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
            queryParams.append('limit', '100');
            queryParams.append('offset', '0');
            
            // æ¤œç´¢ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¿½åŠ 
            Object.keys(params).forEach(key => {
                if (params[key]) {
                    queryParams.append(key, params[key]);
                }
            });
            
            const targetUrl = `${apiBase}?${queryParams.toString()}`;
            logMessage(`    ğŸ“¡ APIå‘¼ã³å‡ºã—: ${targetUrl}`);
            
            // è¤‡æ•°ã®CORSå›é¿æ–¹æ³•ã‚’é †æ¬¡è©¦è¡Œ
            const corsWorkarounds = [
                // ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆCORSãŒè¨±å¯ã•ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
                {
                    url: targetUrl,
                    options: {
                        mode: 'cors',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        }
                    }
                },
                // AllOrigins ãƒ—ãƒ­ã‚­ã‚·
                {
                    url: `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`,
                    options: {},
                    extractJson: (data) => JSON.parse(data.contents)
                },
                // ThingProxy
                {
                    url: `https://thingproxy.freeboard.io/fetch/${targetUrl}`,
                    options: {}
                }
            ];
            
            for (const workaround of corsWorkarounds) {
                try {
                    const response = await fetch(workaround.url, workaround.options);
                    
                    if (response.ok) {
                        let data = await response.json();
                        
                        // ãƒ—ãƒ­ã‚­ã‚·çµŒç”±ã®å ´åˆã¯ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
                        if (workaround.extractJson && data.contents) {
                            data = workaround.extractJson(data);
                        }
                        
                        logMessage(`    âœ… APIæˆåŠŸ: ${workaround.url.split('/')[2]}`);
                        return parseAPIResponse(data);
                    }
                } catch (error) {
                    logMessage(`    âŒ APIå¤±æ•—: ${error.message}`);
                }
            }
            
            throw new Error('å…¨ã¦ã®CORSå›é¿æ–¹æ³•ãŒå¤±æ•—ã—ã¾ã—ãŸ');
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        window.addEventListener('load', init);
    </script>

    <!-- Google Maps API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcx2v4xS9VuQjHzhME5Fz3Uazig3l62RI&libraries=geometry&callback=initMap">
    </script>
</body>
</html>